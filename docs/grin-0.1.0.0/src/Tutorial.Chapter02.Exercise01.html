<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE LambdaCase, TypeFamilies #-}</span><span>
</span><a name="line-2"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Tutorial.Chapter02.Exercise01</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-3"></a><span>
</span><a name="line-4"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">void</span><span class="hs-special">)</span><span>
</span><a name="line-5"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad.Fail</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadFail</span><span class="hs-special">)</span><span>
</span><a name="line-6"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad.Trans</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadIO</span><span class="hs-special">)</span><span>
</span><a name="line-7"></a><span class="hs-keyword">import</span><span> </span><a href="Grin.Exp.html"><span class="hs-identifier">Grin.Exp</span></a><span> </span><span class="hs-special">(</span><a href="Grin.Exp.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Grin.Exp.html#Alt"><span class="hs-identifier hs-type">Alt</span></a><span class="hs-special">,</span><span> </span><a href="Grin.Exp.html#BPat"><span class="hs-identifier hs-type">BPat</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-8"></a><span class="hs-keyword">import</span><span> </span><a href="Grin.Value.html"><span class="hs-identifier">Grin.Value</span></a><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><a href="Grin.Value.html#Val"><span class="hs-identifier hs-type">Val</span></a><span class="hs-special">)</span><span>
</span><a name="line-9"></a><span>
</span><a name="line-10"></a><span class="hs-keyword">import</span><span> </span><a href="Grin.Interpreter.Env.html"><span class="hs-identifier">Grin.Interpreter.Env</span></a><span> </span><span class="hs-special">(</span><a href="Grin.Interpreter.Env.html#Env"><span class="hs-identifier hs-type">Env</span></a><span class="hs-special">)</span><span>
</span><a name="line-11"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Grin.Interpreter.Env.html"><span class="hs-identifier">Grin.Interpreter.Env</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Env</span><span>
</span><a name="line-12"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Grin.Value.html"><span class="hs-identifier">Grin.Value</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Grin</span><span>
</span><a name="line-13"></a><span>
</span><a name="line-14"></a><span class="hs-keyword">import</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html"><span class="hs-identifier">Tutorial.Chapter01.Exercise02</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#Definitional"><span class="hs-identifier hs-type">Definitional</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-15"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html"><span class="hs-identifier">Tutorial.Chapter01.Exercise02</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Definitional</span><span>
</span><a name="line-16"></a><span>
</span><a name="line-17"></a><span>
</span><a name="line-18"></a><span class="hs-comment">{-
Motivation:
The talk is based on the Abstracting Definitional Interpreters [1].

In this paper they claim that the same structure for the definitional
interpreter can be reused to create abstract interpreters which
are some form of inference. We will see that type inference
can be encoded using abstract interpretation.

The main motivation here is to understand how the abstraction of
the definitional interpreter can be achieved.

The paper uses open recursion technique to make possible to inject
different aspects of the recursive calls.

This approach is also used in the `semantic` framework by github [2].

[1] https://plum-umd.github.io/abstracting-definitional-interpreters/
[2] https://github.com/github/semantic

Exercise:
Read the &quot;2 From Machines to Compositional Evaluators&quot;
https://plum-umd.github.io/abstracting-definitional-interpreters/#%28part._s~3aaam%29

Although GRIN is not a higher-order lanuage, we use the AAM approach.

Exercise:
Find the difference between the interpreter from the previous exercise.
-}</span><span>
</span><a name="line-47"></a><span>
</span><a name="line-48"></a><span class="hs-comment">-- | The interpreter is written in an open recursive style;</span><span>
</span><a name="line-49"></a><span class="hs-comment">-- the evaluator does not call itself recursively, instead it takes as an argument</span><span>
</span><a name="line-50"></a><span class="hs-comment">-- a function ev (the argument) is called instead of self-recursion.</span><span>
</span><a name="line-51"></a><span class="hs-comment">-- This is a standard encoding for recursive functions in a setting without recursive binding.</span><span>
</span><a name="line-52"></a><span class="hs-comment">-- It is up to an external function, such as the Y-combinator, to close the recursive loop.</span><span>
</span><a name="line-53"></a><span class="hs-comment">-- This open recursive form is crucial because it allows intercepting recursive calls</span><span>
</span><a name="line-54"></a><span class="hs-comment">-- to perform &#8220;deep&#8221; instrumentation of the interpreter.</span><span>
</span><a name="line-55"></a><span>
</span><a name="line-56"></a><span class="hs-identifier">eval</span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679282865"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><a href="Tutorial.Chapter02.Exercise01.html#Interpreter"><span class="hs-identifier hs-type">Interpreter</span></a><span> </span><a href="#local-6989586621679282865"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-57"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="Grin.Exp.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679282865"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter02.Exercise01.html#Val"><span class="hs-identifier hs-type">Val</span></a><span> </span><a href="#local-6989586621679282865"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Grin.Exp.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679282865"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter02.Exercise01.html#Val"><span class="hs-identifier hs-type">Val</span></a><span> </span><a href="#local-6989586621679282865"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-58"></a><a name="eval"><a href="Tutorial.Chapter02.Exercise01.html#eval"><span class="hs-identifier">eval</span></a></a><span> </span><a name="local-6989586621679282866"><a href="#local-6989586621679282866"><span class="hs-identifier">ev</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-59"></a><span>  </span><a href="Grin.Exp.html#SPure"><span class="hs-identifier hs-var">SPure</span></a><span> </span><span class="hs-special">(</span><a href="Grin.Value.html#Val"><span class="hs-identifier hs-var">Grin.Val</span></a><span> </span><a name="local-6989586621679282867"><a href="#local-6989586621679282867"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Tutorial.Chapter02.Exercise01.html#value"><span class="hs-identifier hs-var">value</span></a><span> </span><a href="#local-6989586621679282867"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-60"></a><span>  </span><a href="Grin.Exp.html#SPure"><span class="hs-identifier hs-var">SPure</span></a><span> </span><span class="hs-special">(</span><a href="Grin.Value.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a name="local-6989586621679282868"><a href="#local-6989586621679282868"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-61"></a><span>    </span><a name="local-6989586621679282869"><a href="#local-6989586621679282869"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Tutorial.Chapter02.Exercise01.html#askEnv"><span class="hs-identifier hs-var">askEnv</span></a><span>
</span><a name="line-62"></a><span>    </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Grin.Interpreter.Env.html#lookup"><span class="hs-identifier hs-var">Env.lookup</span></a><span> </span><a href="#local-6989586621679282869"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679282868"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-63"></a><span>
</span><a name="line-64"></a><span>  </span><a href="Grin.Exp.html#SApp"><span class="hs-identifier hs-var">SApp</span></a><span> </span><a name="local-6989586621679282870"><a href="#local-6989586621679282870"><span class="hs-identifier">fn</span></a></a><span> </span><a name="local-6989586621679282871"><a href="#local-6989586621679282871"><span class="hs-identifier">ps</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-65"></a><span>    </span><a name="local-6989586621679282872"><a href="#local-6989586621679282872"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Tutorial.Chapter02.Exercise01.html#askEnv"><span class="hs-identifier hs-var">askEnv</span></a><span>
</span><a name="line-66"></a><span>    </span><a name="local-6989586621679282873"><a href="#local-6989586621679282873"><span class="hs-identifier">vs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="Grin.Interpreter.Env.html#lookup"><span class="hs-identifier hs-var">Env.lookup</span></a><span> </span><a href="#local-6989586621679282872"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679282871"><span class="hs-identifier hs-var">ps</span></a><span>
</span><a name="line-67"></a><span>    </span><a name="local-6989586621679282874"><a href="#local-6989586621679282874"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Tutorial.Chapter02.Exercise01.html#isExternal"><span class="hs-identifier hs-var">isExternal</span></a><span> </span><a href="#local-6989586621679282870"><span class="hs-identifier hs-var">fn</span></a><span>
</span><a name="line-68"></a><span>    </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679282874"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="Tutorial.Chapter02.Exercise01.html#external"><span class="hs-identifier hs-var">external</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="Tutorial.Chapter02.Exercise01.html#funCall"><span class="hs-identifier hs-var">funCall</span></a><span> </span><a href="#local-6989586621679282866"><span class="hs-identifier hs-var">ev</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679282870"><span class="hs-identifier hs-var">fn</span></a><span> </span><a href="#local-6989586621679282873"><span class="hs-identifier hs-var">vs</span></a><span>
</span><a name="line-69"></a><span>
</span><a name="line-70"></a><span>  </span><a href="Grin.Exp.html#SFetch"><span class="hs-identifier hs-var">SFetch</span></a><span> </span><a name="local-6989586621679282875"><a href="#local-6989586621679282875"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-71"></a><span>    </span><a name="local-6989586621679282876"><a href="#local-6989586621679282876"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Tutorial.Chapter02.Exercise01.html#askEnv"><span class="hs-identifier hs-var">askEnv</span></a><span>
</span><a name="line-72"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679282877"><a href="#local-6989586621679282877"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Grin.Interpreter.Env.html#lookup"><span class="hs-identifier hs-var">Env.lookup</span></a><span> </span><a href="#local-6989586621679282876"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679282875"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-73"></a><span>    </span><a href="Tutorial.Chapter02.Exercise01.html#fetchStore"><span class="hs-identifier hs-var">fetchStore</span></a><span> </span><a href="#local-6989586621679282877"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-74"></a><span>
</span><a name="line-75"></a><span>  </span><a href="Grin.Exp.html#SUpdate"><span class="hs-identifier hs-var">SUpdate</span></a><span> </span><a name="local-6989586621679282878"><a href="#local-6989586621679282878"><span class="hs-identifier">nl</span></a></a><span> </span><a name="local-6989586621679282879"><a href="#local-6989586621679282879"><span class="hs-identifier">nn</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-76"></a><span>    </span><a name="local-6989586621679282880"><a href="#local-6989586621679282880"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Tutorial.Chapter02.Exercise01.html#askEnv"><span class="hs-identifier hs-var">askEnv</span></a><span>
</span><a name="line-77"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679282881"><a href="#local-6989586621679282881"><span class="hs-identifier">vl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Grin.Interpreter.Env.html#lookup"><span class="hs-identifier hs-var">Env.lookup</span></a><span> </span><a href="#local-6989586621679282880"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679282878"><span class="hs-identifier hs-var">nl</span></a><span>
</span><a name="line-78"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679282882"><a href="#local-6989586621679282882"><span class="hs-identifier">vn</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Grin.Interpreter.Env.html#lookup"><span class="hs-identifier hs-var">Env.lookup</span></a><span> </span><a href="#local-6989586621679282880"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679282879"><span class="hs-identifier hs-var">nn</span></a><span>
</span><a name="line-79"></a><span>    </span><a href="Tutorial.Chapter02.Exercise01.html#extStore"><span class="hs-identifier hs-var">extStore</span></a><span> </span><a href="#local-6989586621679282881"><span class="hs-identifier hs-var">vl</span></a><span> </span><a href="#local-6989586621679282882"><span class="hs-identifier hs-var">vn</span></a><span>
</span><a name="line-80"></a><span>    </span><span class="hs-keyword">unit</span><span>
</span><a name="line-81"></a><span>
</span><a name="line-82"></a><span>  </span><a href="Grin.Exp.html#ECase"><span class="hs-identifier hs-var">ECase</span></a><span> </span><a name="local-6989586621679282883"><a href="#local-6989586621679282883"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679282884"><a href="#local-6989586621679282884"><span class="hs-identifier">alts</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-83"></a><span>    </span><a name="local-6989586621679282885"><a href="#local-6989586621679282885"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Tutorial.Chapter02.Exercise01.html#askEnv"><span class="hs-identifier hs-var">askEnv</span></a><span>
</span><a name="line-84"></a><span>    </span><a name="local-6989586621679282886"><a href="#local-6989586621679282886"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Grin.Interpreter.Env.html#lookup"><span class="hs-identifier hs-var">Env.lookup</span></a><span> </span><a href="#local-6989586621679282885"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679282883"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-85"></a><span>    </span><span class="hs-comment">-- Select the alternative and continue the evaluation</span><span>
</span><a name="line-86"></a><span>    </span><a href="Tutorial.Chapter02.Exercise01.html#evalCase"><span class="hs-identifier hs-var">evalCase</span></a><span> </span><a href="#local-6989586621679282866"><span class="hs-identifier hs-var">ev</span></a><span> </span><a href="#local-6989586621679282886"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621679282884"><span class="hs-identifier hs-var">alts</span></a><span>
</span><a name="line-87"></a><span>
</span><a name="line-88"></a><span>  </span><a href="Grin.Exp.html#EBind"><span class="hs-identifier hs-var">EBind</span></a><span> </span><span class="hs-special">(</span><a href="Grin.Exp.html#SStore"><span class="hs-identifier hs-var">SStore</span></a><span> </span><a name="local-6989586621679282887"><a href="#local-6989586621679282887"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Grin.Exp.html#BVar"><span class="hs-identifier hs-var">BVar</span></a><span> </span><a name="local-6989586621679282888"><a href="#local-6989586621679282888"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679282889"><a href="#local-6989586621679282889"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-89"></a><span>    </span><a name="local-6989586621679282890"><a href="#local-6989586621679282890"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Tutorial.Chapter02.Exercise01.html#askEnv"><span class="hs-identifier hs-var">askEnv</span></a><span>
</span><a name="line-90"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679282891"><a href="#local-6989586621679282891"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Grin.Interpreter.Env.html#lookup"><span class="hs-identifier hs-var">Env.lookup</span></a><span> </span><a href="#local-6989586621679282890"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679282887"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-91"></a><span>    </span><a name="local-6989586621679282892"><a href="#local-6989586621679282892"><span class="hs-identifier">a</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Tutorial.Chapter02.Exercise01.html#allocStore"><span class="hs-identifier hs-var">allocStore</span></a><span> </span><a href="#local-6989586621679282888"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-92"></a><span>    </span><a href="Tutorial.Chapter02.Exercise01.html#extStore"><span class="hs-identifier hs-var">extStore</span></a><span> </span><a href="#local-6989586621679282892"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679282891"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-93"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679282893"><a href="#local-6989586621679282893"><span class="hs-identifier">p'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Grin.Interpreter.Env.html#insert"><span class="hs-identifier hs-var">Env.insert</span></a><span> </span><a href="#local-6989586621679282888"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679282892"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679282890"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-94"></a><span>    </span><a href="Tutorial.Chapter02.Exercise01.html#localEnv"><span class="hs-identifier hs-var">localEnv</span></a><span> </span><a href="#local-6989586621679282893"><span class="hs-identifier hs-var">p'</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679282866"><span class="hs-identifier hs-var">ev</span></a><span> </span><a href="#local-6989586621679282889"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">)</span><span>
</span><a name="line-95"></a><span>
</span><a name="line-96"></a><span>  </span><a href="Grin.Exp.html#EBind"><span class="hs-identifier hs-var">EBind</span></a><span> </span><a name="local-6989586621679282894"><a href="#local-6989586621679282894"><span class="hs-identifier">lhs</span></a></a><span> </span><span class="hs-special">(</span><a href="Grin.Exp.html#BVar"><span class="hs-identifier hs-var">BVar</span></a><span> </span><a name="local-6989586621679282895"><a href="#local-6989586621679282895"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679282896"><a href="#local-6989586621679282896"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-97"></a><span>    </span><a name="local-6989586621679282897"><a href="#local-6989586621679282897"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679282866"><span class="hs-identifier hs-var">ev</span></a><span> </span><a href="#local-6989586621679282894"><span class="hs-identifier hs-var">lhs</span></a><span>
</span><a name="line-98"></a><span>    </span><a name="local-6989586621679282898"><a href="#local-6989586621679282898"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Tutorial.Chapter02.Exercise01.html#askEnv"><span class="hs-identifier hs-var">askEnv</span></a><span>
</span><a name="line-99"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679282899"><a href="#local-6989586621679282899"><span class="hs-identifier">p'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Grin.Interpreter.Env.html#insert"><span class="hs-identifier hs-var">Env.insert</span></a><span> </span><a href="#local-6989586621679282895"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679282897"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621679282898"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-100"></a><span>    </span><a href="Tutorial.Chapter02.Exercise01.html#localEnv"><span class="hs-identifier hs-var">localEnv</span></a><span> </span><a href="#local-6989586621679282899"><span class="hs-identifier hs-var">p'</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679282866"><span class="hs-identifier hs-var">ev</span></a><span> </span><a href="#local-6989586621679282896"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">)</span><span>
</span><a name="line-101"></a><span>
</span><a name="line-102"></a><span>  </span><a href="Grin.Exp.html#EBind"><span class="hs-identifier hs-var">EBind</span></a><span> </span><a name="local-6989586621679282900"><a href="#local-6989586621679282900"><span class="hs-identifier">lhs</span></a></a><span> </span><span class="hs-special">(</span><a href="Grin.Exp.html#BNodePat"><span class="hs-identifier hs-var">BNodePat</span></a><span> </span><a name="local-6989586621679282901"><a href="#local-6989586621679282901"><span class="hs-identifier">t</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Grin.Value.html#Tag"><span class="hs-identifier hs-var">Tag</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679282902"><a href="#local-6989586621679282902"><span class="hs-identifier">vs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679282903"><a href="#local-6989586621679282903"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-103"></a><span>    </span><a name="local-6989586621679282904"><a href="#local-6989586621679282904"><span class="hs-identifier">v</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679282866"><span class="hs-identifier hs-var">ev</span></a><span> </span><a href="#local-6989586621679282900"><span class="hs-identifier hs-var">lhs</span></a><span>
</span><a name="line-104"></a><span>    </span><a name="local-6989586621679282905"><a href="#local-6989586621679282905"><span class="hs-identifier">p</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Tutorial.Chapter02.Exercise01.html#askEnv"><span class="hs-identifier hs-var">askEnv</span></a><span>
</span><a name="line-105"></a><span>    </span><a name="local-6989586621679282906"><a href="#local-6989586621679282906"><span class="hs-identifier">p'</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">flip</span><span> </span><a href="Grin.Interpreter.Env.html#inserts"><span class="hs-identifier hs-var">Env.inserts</span></a><span> </span><a href="#local-6989586621679282905"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Tutorial.Chapter02.Exercise01.html#bindPattern"><span class="hs-identifier hs-var">bindPattern</span></a><span> </span><a href="#local-6989586621679282904"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679282901"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">,</span><a href="#local-6989586621679282902"><span class="hs-identifier hs-var">vs</span></a><span class="hs-special">)</span><span>
</span><a name="line-106"></a><span>    </span><a href="Tutorial.Chapter02.Exercise01.html#localEnv"><span class="hs-identifier hs-var">localEnv</span></a><span> </span><a href="#local-6989586621679282906"><span class="hs-identifier hs-var">p'</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679282866"><span class="hs-identifier hs-var">ev</span></a><span> </span><a href="#local-6989586621679282903"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">)</span><span>
</span><a name="line-107"></a><span>
</span><a name="line-108"></a><span>  </span><a href="Grin.Exp.html#EBind"><span class="hs-identifier hs-var">EBind</span></a><span> </span><a name="local-6989586621679282907"><a href="#local-6989586621679282907"><span class="hs-identifier">lhs</span></a></a><span> </span><a href="Grin.Exp.html#BUnit"><span class="hs-identifier hs-var">BUnit</span></a><span> </span><a name="local-6989586621679282908"><a href="#local-6989586621679282908"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-109"></a><span>    </span><span class="hs-identifier hs-var">void</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679282866"><span class="hs-identifier hs-var">ev</span></a><span> </span><a href="#local-6989586621679282907"><span class="hs-identifier hs-var">lhs</span></a><span>
</span><a name="line-110"></a><span>    </span><a href="#local-6989586621679282866"><span class="hs-identifier hs-var">ev</span></a><span> </span><a href="#local-6989586621679282908"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-111"></a><span>
</span><a name="line-112"></a><span>  </span><a href="Grin.Exp.html#Alt"><span class="hs-identifier hs-var">Alt</span></a><span> </span><a name="local-6989586621679282909"><a href="#local-6989586621679282909"><span class="hs-identifier">_pat</span></a></a><span> </span><a name="local-6989586621679282910"><a href="#local-6989586621679282910"><span class="hs-identifier">body</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-113"></a><span>    </span><a href="#local-6989586621679282866"><span class="hs-identifier hs-var">ev</span></a><span> </span><a href="#local-6989586621679282910"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-114"></a><span>
</span><a name="line-115"></a><span>  </span><a name="local-6989586621679282911"><a href="#local-6989586621679282911"><span class="hs-identifier">overGenerative</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679282911"><span class="hs-identifier hs-var">overGenerative</span></a><span>
</span><a name="line-116"></a><span>
</span><a name="line-117"></a><span class="hs-comment">{-
Solution:
The differences are, the open recursion style and the application of the typeclass.
-}</span><span>
</span><a name="line-121"></a><span>
</span><a name="line-122"></a><span class="hs-comment">{-
Exercise:
Discuss with somebody why the associated types are necessary, in this formalism?
Diccuss why is necessary to include the 'm' type in the type of the return values.
Understand the type signatures.
-}</span><span>
</span><a name="line-128"></a><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonadFail</span><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a name="Interpreter"><a href="Tutorial.Chapter02.Exercise01.html#Interpreter"><span class="hs-identifier">Interpreter</span></a></a><span> </span><a name="local-6989586621679282863"><a href="#local-6989586621679282863"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-129"></a><span>  </span><span class="hs-keyword">type</span><span> </span><a name="Val"><a href="Tutorial.Chapter02.Exercise01.html#Val"><span class="hs-identifier">Val</span></a></a><span>     </span><a name="local-6989586621679282863"><a href="#local-6989586621679282863"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-operator">*</span><span> </span><span class="hs-comment">-- Values that can be placed in registers/variables</span><span>
</span><a name="line-130"></a><span>  </span><span class="hs-keyword">type</span><span> </span><a name="HeapVal"><a href="Tutorial.Chapter02.Exercise01.html#HeapVal"><span class="hs-identifier">HeapVal</span></a></a><span> </span><a name="local-6989586621679282863"><a href="#local-6989586621679282863"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-operator">*</span><span> </span><span class="hs-comment">-- Values for the Store, Fetch, Update parameters</span><span>
</span><a name="line-131"></a><span>  </span><span class="hs-keyword">type</span><span> </span><a name="Addr"><a href="Tutorial.Chapter02.Exercise01.html#Addr"><span class="hs-identifier">Addr</span></a></a><span>    </span><a name="local-6989586621679282863"><a href="#local-6989586621679282863"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-operator">*</span><span> </span><span class="hs-comment">-- A type to represent an Address</span><span>
</span><a name="line-132"></a><span>
</span><a name="line-133"></a><span>  </span><span class="hs-comment">-- Conversions, but m type is needed for type inference</span><span>
</span><a name="line-134"></a><span>  </span><a name="value"><a href="Tutorial.Chapter02.Exercise01.html#value"><span class="hs-identifier">value</span></a></a><span>       </span><span class="hs-glyph">::</span><span> </span><a href="Grin.Value.html#Value"><span class="hs-identifier hs-type">Grin.Value</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter02.Exercise01.html#Val"><span class="hs-identifier hs-type">Val</span></a><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>      </span><span class="hs-comment">-- Value of the given literal</span><span>
</span><a name="line-135"></a><span>  </span><a name="val2addr"><a href="Tutorial.Chapter02.Exercise01.html#val2addr"><span class="hs-identifier">val2addr</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Tutorial.Chapter02.Exercise01.html#Val"><span class="hs-identifier hs-type">Val</span></a><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter02.Exercise01.html#Addr"><span class="hs-identifier hs-type">Addr</span></a><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- Convert a value to an Address value</span><span>
</span><a name="line-136"></a><span>  </span><a name="addr2val"><a href="Tutorial.Chapter02.Exercise01.html#addr2val"><span class="hs-identifier">addr2val</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Tutorial.Chapter02.Exercise01.html#Addr"><span class="hs-identifier hs-type">Addr</span></a><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter02.Exercise01.html#Val"><span class="hs-identifier hs-type">Val</span></a><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>      </span><span class="hs-comment">-- Convert an address value to a Value</span><span>
</span><a name="line-137"></a><span>  </span><a name="heapVal2val"><a href="Tutorial.Chapter02.Exercise01.html#heapVal2val"><span class="hs-identifier">heapVal2val</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Tutorial.Chapter02.Exercise01.html#HeapVal"><span class="hs-identifier hs-type">HeapVal</span></a><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter02.Exercise01.html#Val"><span class="hs-identifier hs-type">Val</span></a><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>      </span><span class="hs-comment">-- Convert a heap value to a value to be able to assign it to a register</span><span>
</span><a name="line-138"></a><span>  </span><a name="val2heapVal"><a href="Tutorial.Chapter02.Exercise01.html#val2heapVal"><span class="hs-identifier">val2heapVal</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Tutorial.Chapter02.Exercise01.html#Val"><span class="hs-identifier hs-type">Val</span></a><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter02.Exercise01.html#HeapVal"><span class="hs-identifier hs-type">HeapVal</span></a><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Convert a value to a heap value to be able to store it on the Heap</span><span>
</span><a name="line-139"></a><span>  </span><span class="hs-keyword">unit</span><span>        </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter02.Exercise01.html#Val"><span class="hs-identifier hs-type">Val</span></a><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>                      </span><span class="hs-comment">-- The unit value</span><span>
</span><a name="line-140"></a><span>  </span><a name="bindPattern"><a href="Tutorial.Chapter02.Exercise01.html#bindPattern"><span class="hs-identifier">bindPattern</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Tutorial.Chapter02.Exercise01.html#Val"><span class="hs-identifier hs-type">Val</span></a><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Grin.Value.html#Tag"><span class="hs-identifier hs-type">Tag</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Grin.Value.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Grin.Value.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="Tutorial.Chapter02.Exercise01.html#Val"><span class="hs-identifier hs-type">Val</span></a><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- Create a list of bindings matching the value of the given and variable-names</span><span>
</span><a name="line-141"></a><span>
</span><a name="line-142"></a><span>  </span><span class="hs-comment">-- | Return the computational environment</span><span>
</span><a name="line-143"></a><span>  </span><a name="askEnv"><a href="Tutorial.Chapter02.Exercise01.html#askEnv"><span class="hs-identifier">askEnv</span></a></a><span>        </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Grin.Interpreter.Env.html#Env"><span class="hs-identifier hs-type">Env</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter02.Exercise01.html#Val"><span class="hs-identifier hs-type">Val</span></a><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-144"></a><span>  </span><span class="hs-comment">-- | Set the local environment</span><span>
</span><a name="line-145"></a><span>  </span><a name="localEnv"><a href="Tutorial.Chapter02.Exercise01.html#localEnv"><span class="hs-identifier">localEnv</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><a href="Grin.Interpreter.Env.html#Env"><span class="hs-identifier hs-type">Env</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter02.Exercise01.html#Val"><span class="hs-identifier hs-type">Val</span></a><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter02.Exercise01.html#Val"><span class="hs-identifier hs-type">Val</span></a><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter02.Exercise01.html#Val"><span class="hs-identifier hs-type">Val</span></a><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Set the local environment to the given one</span><span>
</span><a name="line-146"></a><span>  </span><a name="lookupFun"><a href="Tutorial.Chapter02.Exercise01.html#lookupFun"><span class="hs-identifier">lookupFun</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><a href="Grin.Value.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Grin.Exp.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span>                          </span><span class="hs-comment">-- Lookup up a function definition</span><span>
</span><a name="line-147"></a><span>  </span><a name="isExternal"><a href="Tutorial.Chapter02.Exercise01.html#isExternal"><span class="hs-identifier">isExternal</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Grin.Value.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>                         </span><span class="hs-comment">-- Check if the given name refers to an external function</span><span>
</span><a name="line-148"></a><span>  </span><a name="external"><a href="Tutorial.Chapter02.Exercise01.html#external"><span class="hs-identifier">external</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><a href="Grin.Value.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Tutorial.Chapter02.Exercise01.html#Val"><span class="hs-identifier hs-type">Val</span></a><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter02.Exercise01.html#Val"><span class="hs-identifier hs-type">Val</span></a><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>           </span><span class="hs-comment">-- Evaluate the external function</span><span>
</span><a name="line-149"></a><span>
</span><a name="line-150"></a><span>  </span><span class="hs-comment">-- Control-flow</span><span>
</span><a name="line-151"></a><span>  </span><a name="evalCase"><a href="Tutorial.Chapter02.Exercise01.html#evalCase"><span class="hs-identifier">evalCase</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Grin.Exp.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter02.Exercise01.html#Val"><span class="hs-identifier hs-type">Val</span></a><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Tutorial.Chapter02.Exercise01.html#Val"><span class="hs-identifier hs-type">Val</span></a><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Grin.Exp.html#Alt"><span class="hs-identifier hs-type">Alt</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter02.Exercise01.html#Val"><span class="hs-identifier hs-type">Val</span></a><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Select an alternative based on the given value and evaluate it</span><span>
</span><a name="line-152"></a><span>  </span><a name="funCall"><a href="Tutorial.Chapter02.Exercise01.html#funCall"><span class="hs-identifier">funCall</span></a></a><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Grin.Exp.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter02.Exercise01.html#Val"><span class="hs-identifier hs-type">Val</span></a><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Grin.Value.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Tutorial.Chapter02.Exercise01.html#Val"><span class="hs-identifier hs-type">Val</span></a><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter02.Exercise01.html#Val"><span class="hs-identifier hs-type">Val</span></a><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Lookup a function and apply to the parameters</span><span>
</span><a name="line-153"></a><span>
</span><a name="line-154"></a><span>  </span><span class="hs-comment">-- Store</span><span>
</span><a name="line-155"></a><span>  </span><a name="allocStore"><a href="Tutorial.Chapter02.Exercise01.html#allocStore"><span class="hs-identifier">allocStore</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Grin.Value.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter02.Exercise01.html#Val"><span class="hs-identifier hs-type">Val</span></a><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- Allocate a new heap location</span><span>
</span><a name="line-156"></a><span>  </span><a name="fetchStore"><a href="Tutorial.Chapter02.Exercise01.html#fetchStore"><span class="hs-identifier">fetchStore</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Tutorial.Chapter02.Exercise01.html#Val"><span class="hs-identifier hs-type">Val</span></a><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter02.Exercise01.html#Val"><span class="hs-identifier hs-type">Val</span></a><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>      </span><span class="hs-comment">-- Fetch the Heap value stored in the heap location</span><span>
</span><a name="line-157"></a><span>  </span><a name="extStore"><a href="Tutorial.Chapter02.Exercise01.html#extStore"><span class="hs-identifier">extStore</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><a href="Tutorial.Chapter02.Exercise01.html#Val"><span class="hs-identifier hs-type">Val</span></a><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Tutorial.Chapter02.Exercise01.html#Val"><span class="hs-identifier hs-type">Val</span></a><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679282863"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Extend the heap location with the given store</span><span>
</span><a name="line-158"></a><span>
</span><a name="line-159"></a><span class="hs-comment">{-
After all the previous implementation of the interpreter can be reused in the
Interpreter typeclass...
-}</span><span>
</span><a name="line-163"></a><span>
</span><a name="line-164"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679282864"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679282864"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonadFail</span><span> </span><a href="#local-6989586621679282864"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Tutorial.Chapter02.Exercise01.html#Interpreter"><span class="hs-identifier hs-type">Interpreter</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#Definitional"><span class="hs-identifier hs-type">Definitional</span></a><span> </span><a href="#local-6989586621679282864"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-165"></a><span>  </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">Val</span><span>     </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#Definitional"><span class="hs-identifier hs-type">Definitional</span></a><span> </span><a href="#local-6989586621679282864"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Value"><span class="hs-identifier hs-type">Definitional.Value</span></a><span>
</span><a name="line-166"></a><span>  </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">HeapVal</span><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#Definitional"><span class="hs-identifier hs-type">Definitional</span></a><span> </span><a href="#local-6989586621679282864"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Node"><span class="hs-identifier hs-type">Definitional.Node</span></a><span>
</span><a name="line-167"></a><span>  </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">Addr</span><span>    </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#Definitional"><span class="hs-identifier hs-type">Definitional</span></a><span> </span><a href="#local-6989586621679282864"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Address"><span class="hs-identifier hs-type">Definitional.Address</span></a><span>
</span><a name="line-168"></a><span>
</span><a name="line-169"></a><span>  </span><a name="local-8214565720324057756"><a href="Tutorial.Chapter02.Exercise01.html#value"><span class="hs-identifier">value</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#value"><span class="hs-identifier hs-var">Definitional.value</span></a><span>
</span><a name="line-170"></a><span>  </span><a name="local-8214565720324057757"><a href="Tutorial.Chapter02.Exercise01.html#val2addr"><span class="hs-identifier">val2addr</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#val2addr"><span class="hs-identifier hs-var">Definitional.val2addr</span></a><span>
</span><a name="line-171"></a><span>  </span><a name="local-8214565720324057758"><a href="Tutorial.Chapter02.Exercise01.html#addr2val"><span class="hs-identifier">addr2val</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#addr2val"><span class="hs-identifier hs-var">Definitional.addr2val</span></a><span>
</span><a name="line-172"></a><span>  </span><a name="local-8214565720324057759"><a href="Tutorial.Chapter02.Exercise01.html#heapVal2val"><span class="hs-identifier">heapVal2val</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#heapVal2val"><span class="hs-identifier hs-var">Definitional.heapVal2val</span></a><span>
</span><a name="line-173"></a><span>  </span><a name="local-8214565720324057760"><a href="Tutorial.Chapter02.Exercise01.html#val2heapVal"><span class="hs-identifier">val2heapVal</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#val2heapVal"><span class="hs-identifier hs-var">Definitional.val2heapVal</span></a><span>
</span><a name="line-174"></a><span>  </span><span class="hs-keyword">unit</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#unit"><span class="hs-identifier hs-var">Definitional.unit</span></a><span>
</span><a name="line-175"></a><span>  </span><a name="local-8214565720324057762"><a href="Tutorial.Chapter02.Exercise01.html#bindPattern"><span class="hs-identifier">bindPattern</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#bindPattern"><span class="hs-identifier hs-var">Definitional.bindPattern</span></a><span>
</span><a name="line-176"></a><span>
</span><a name="line-177"></a><span>  </span><a name="local-8214565720324057763"><a href="Tutorial.Chapter02.Exercise01.html#askEnv"><span class="hs-identifier">askEnv</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#askEnv"><span class="hs-identifier hs-var">Definitional.askEnv</span></a><span>
</span><a name="line-178"></a><span>  </span><a name="local-8214565720324057764"><a href="Tutorial.Chapter02.Exercise01.html#localEnv"><span class="hs-identifier">localEnv</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#localEnv"><span class="hs-identifier hs-var">Definitional.localEnv</span></a><span>
</span><a name="line-179"></a><span>  </span><a name="local-8214565720324057765"><a href="Tutorial.Chapter02.Exercise01.html#lookupFun"><span class="hs-identifier">lookupFun</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#lookupFun"><span class="hs-identifier hs-var">Definitional.lookupFun</span></a><span>
</span><a name="line-180"></a><span>  </span><a name="local-8214565720324057766"><a href="Tutorial.Chapter02.Exercise01.html#isExternal"><span class="hs-identifier">isExternal</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#isExternal"><span class="hs-identifier hs-var">Definitional.isExternal</span></a><span>
</span><a name="line-181"></a><span>  </span><a name="local-8214565720324057767"><a href="Tutorial.Chapter02.Exercise01.html#external"><span class="hs-identifier">external</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#external"><span class="hs-identifier hs-var">Definitional.external</span></a><span>
</span><a name="line-182"></a><span>
</span><a name="line-183"></a><span>  </span><a name="local-8214565720324057768"><a href="Tutorial.Chapter02.Exercise01.html#evalCase"><span class="hs-identifier">evalCase</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#evalCase"><span class="hs-identifier hs-var">Definitional.evalCase</span></a><span>
</span><a name="line-184"></a><span>  </span><a name="local-8214565720324057769"><a href="Tutorial.Chapter02.Exercise01.html#funCall"><span class="hs-identifier">funCall</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#funCall"><span class="hs-identifier hs-var">Definitional.funCall</span></a><span>
</span><a name="line-185"></a><span>
</span><a name="line-186"></a><span>  </span><a name="local-8214565720324057770"><a href="Tutorial.Chapter02.Exercise01.html#allocStore"><span class="hs-identifier">allocStore</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#allocStore"><span class="hs-identifier hs-var">Definitional.allocStore</span></a><span>
</span><a name="line-187"></a><span>  </span><a name="local-8214565720324057771"><a href="Tutorial.Chapter02.Exercise01.html#fetchStore"><span class="hs-identifier">fetchStore</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#fetchStore"><span class="hs-identifier hs-var">Definitional.fetchStore</span></a><span>
</span><a name="line-188"></a><span>  </span><a name="local-8214565720324057772"><a href="Tutorial.Chapter02.Exercise01.html#extStore"><span class="hs-identifier">extStore</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#extStore"><span class="hs-identifier hs-var">Definitional.extStore</span></a><span>
</span><a name="line-189"></a></pre></body></html>