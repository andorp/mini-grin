<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# OPTIONS_GHC -Wno-unused-matches #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving, LambdaCase, ConstraintKinds #-}</span><span>
</span><a name="line-3"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Tutorial.Chapter01.Exercise02</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-4"></a><span>
</span><a name="line-5"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Int</span><span>
</span><a name="line-6"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Word</span><span>
</span><a name="line-7"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Maybe</span><span>
</span><a name="line-8"></a><span class="hs-keyword">import</span><span> </span><a href="Grin.Exp.html"><span class="hs-identifier">Grin.Exp</span></a><span> </span><span class="hs-special">(</span><a href="Grin.Exp.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Grin.Exp.html#Program"><span class="hs-identifier hs-type">Program</span></a><span class="hs-special">,</span><span> </span><a href="Grin.Exp.html#Alt"><span class="hs-identifier hs-type">Alt</span></a><span class="hs-special">,</span><span> </span><a href="Grin.Exp.html#BPat"><span class="hs-identifier hs-type">BPat</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Grin.Exp.html#CPat"><span class="hs-identifier hs-type">CPat</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Grin.Exp.html#programToDefs"><span class="hs-identifier hs-var">programToDefs</span></a><span class="hs-special">)</span><span>
</span><a name="line-9"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad.Fail</span><span>
</span><a name="line-10"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad.Reader</span><span>
</span><a name="line-11"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad.State</span><span>
</span><a name="line-12"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad.Trans.RWS.Strict</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">RWST</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-13"></a><span>
</span><a name="line-14"></a><span class="hs-keyword">import</span><span> </span><a href="Grin.Interpreter.Env.html"><span class="hs-identifier">Grin.Interpreter.Env</span></a><span> </span><span class="hs-special">(</span><a href="Grin.Interpreter.Env.html#Env"><span class="hs-identifier hs-type">Env</span></a><span class="hs-special">)</span><span>
</span><a name="line-15"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Grin.Interpreter.Env.html"><span class="hs-identifier">Grin.Interpreter.Env</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Env</span><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span> </span><a href="Grin.Interpreter.Store.html"><span class="hs-identifier">Grin.Interpreter.Store</span></a><span> </span><span class="hs-special">(</span><a href="Grin.Interpreter.Store.html#Store"><span class="hs-identifier hs-type">Store</span></a><span class="hs-special">)</span><span>
</span><a name="line-17"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Grin.Interpreter.Store.html"><span class="hs-identifier">Grin.Interpreter.Store</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Store</span><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Grin.Value.html"><span class="hs-identifier">Grin.Value</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Grin</span><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map.Strict</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Lens.Micro.Platform</span><span>
</span><a name="line-21"></a><span>
</span><a name="line-22"></a><span class="hs-comment">{-
Motivation:
To give a language meaning one could write an interpreter.

Using the interpreter we can define the operational semantics
of a language. The interpreter can also be regarded as a state
transition system over a given abstract domain.

This approach is called the DEFINITIONAL INTERPRETER.

Our domain consist of
  * an Environment, which associates variables with values, AND
  -- NOTE: consider renamind Store -&gt; (Abstract) Heap [to avoid confusion about store operation]
  * a Store (Heap) which represents the memory of the machine. The
    store associates heap locations (Addresses) with values.

Exercise: Read the Grin.Interpreter.Env module
Exercise: Read the Grin.Interpreter.Store module

During the interpretation
 * The environment associates variables with values
   which can be of three kinds:
    * Primitive (SValue)
    * Node
    * Unit
   Values of type Unit can be created by an Update operation,
   or an effectful external operation.
 * The store can only hold Node values (similar to C-style structs)

Note:
GRIN programs are in Static Single Assignment form,
which means rebinding a variable is illegal.

Exercise: Read the definition of Value, Node and SValue types below. These types represent
values in a running interpreter.
-}</span><span>
</span><a name="line-58"></a><span>
</span><a name="line-59"></a><span class="hs-keyword">data</span><span> </span><a name="Value"><a href="Tutorial.Chapter01.Exercise02.html#Value"><span class="hs-identifier">Value</span></a></a><span>       </span><span class="hs-comment">-- A runtime value can be:</span><span>
</span><a name="line-60"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="Prim"><a href="Tutorial.Chapter01.Exercise02.html#Prim"><span class="hs-identifier">Prim</span></a></a><span> </span><a href="Tutorial.Chapter01.Exercise02.html#SValue"><span class="hs-identifier hs-type">SValue</span></a><span>  </span><span class="hs-comment">-- A primitive value as simple value</span><span>
</span><a name="line-61"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Node"><a href="Tutorial.Chapter01.Exercise02.html#Node"><span class="hs-identifier">Node</span></a></a><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Node"><span class="hs-identifier hs-type">Node</span></a><span>    </span><span class="hs-comment">-- A node value which represents a node in the graph</span><span>
</span><a name="line-62"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Unit"><a href="Tutorial.Chapter01.Exercise02.html#Unit"><span class="hs-identifier">Unit</span></a></a><span>         </span><span class="hs-comment">-- The UNIT value, which represents no information at all. Like () in Haskell.</span><span>
</span><a name="line-63"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-64"></a><span>
</span><a name="line-65"></a><span class="hs-keyword">data</span><span> </span><a name="Node"><a href="Tutorial.Chapter01.Exercise02.html#Node"><span class="hs-identifier">Node</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="N"><a href="Tutorial.Chapter01.Exercise02.html#N"><span class="hs-identifier">N</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="tag"><a href="Tutorial.Chapter01.Exercise02.html#tag"><span class="hs-identifier">tag</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Grin.Value.html#Tag"><span class="hs-identifier hs-type">Grin.Tag</span></a><span class="hs-special">,</span><span> </span><a name="args"><a href="Tutorial.Chapter01.Exercise02.html#args"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Tutorial.Chapter01.Exercise02.html#SValue"><span class="hs-identifier hs-type">SValue</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-66"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-67"></a><span>
</span><a name="line-68"></a><span class="hs-keyword">data</span><span> </span><a name="SValue"><a href="Tutorial.Chapter01.Exercise02.html#SValue"><span class="hs-identifier">SValue</span></a></a><span>
</span><a name="line-69"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="SInt64"><a href="Tutorial.Chapter01.Exercise02.html#SInt64"><span class="hs-identifier">SInt64</span></a></a><span>  </span><span class="hs-identifier hs-type">Int64</span><span>
</span><a name="line-70"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="SWord64"><a href="Tutorial.Chapter01.Exercise02.html#SWord64"><span class="hs-identifier">SWord64</span></a></a><span> </span><span class="hs-identifier hs-type">Word64</span><span>
</span><a name="line-71"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="SFloat"><a href="Tutorial.Chapter01.Exercise02.html#SFloat"><span class="hs-identifier">SFloat</span></a></a><span>  </span><span class="hs-identifier hs-type">Float</span><span>
</span><a name="line-72"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="SBool"><a href="Tutorial.Chapter01.Exercise02.html#SBool"><span class="hs-identifier">SBool</span></a></a><span>   </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-73"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="SChar"><a href="Tutorial.Chapter01.Exercise02.html#SChar"><span class="hs-identifier">SChar</span></a></a><span>   </span><span class="hs-identifier hs-type">Char</span><span>
</span><a name="line-74"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="SLoc"><a href="Tutorial.Chapter01.Exercise02.html#SLoc"><span class="hs-identifier">SLoc</span></a></a><span>    </span><a href="Tutorial.Chapter01.Exercise02.html#Address"><span class="hs-identifier hs-type">Address</span></a><span>
</span><a name="line-75"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-76"></a><span>
</span><a name="line-77"></a><span class="hs-comment">-- | For simplicity's sake, we will represent addresses using Ints.</span><span>
</span><a name="line-78"></a><span class="hs-keyword">type</span><span> </span><a name="Address"><a href="Tutorial.Chapter01.Exercise02.html#Address"><span class="hs-identifier">Address</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-79"></a><span>
</span><a name="line-80"></a><span class="hs-comment">{-
The structure of the interpreter can be represented as a Monad Transformer, which
operates on a given Monad 'm', which can run arbitrary IO computations.

The Env represents the frame, which holds values for variables. The MonadReader abstraction
fits well with the frame abstraction.

The Heap associates Addresses with Node values, during the execution of the program,
contents of the heap location associated with the given address may change.

 * Store: A new address is allocated using the Store operation, which creates a new heap
   location, saves the value of which was given to the Store operation via a variable
   those value must be looked up from the Env.
   The store operation returns the newly created address.
 * Fetch: The content of a given address can be retrieved using the Fetch operation. The
   parameter of the operation is a variable which holds an address value.
 * Update: The content of an address can be overwritten using the Update operation.
-}</span><span>
</span><a name="line-98"></a><span>
</span><a name="line-99"></a><span class="hs-comment">-- | How to interpret External names in the interpreter.</span><span>
</span><a name="line-100"></a><span class="hs-keyword">type</span><span> </span><a name="InterpretExternal"><a href="Tutorial.Chapter01.Exercise02.html#InterpretExternal"><span class="hs-identifier">InterpretExternal</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Map.Map</span><span> </span><a href="Grin.Value.html#Name"><span class="hs-identifier hs-type">Grin.Name</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Tutorial.Chapter01.Exercise02.html#Value"><span class="hs-identifier hs-type">Value</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Value"><span class="hs-identifier hs-type">Value</span></a><span class="hs-special">)</span><span>
</span><a name="line-101"></a><span>
</span><a name="line-102"></a><span class="hs-keyword">data</span><span> </span><a name="Functions"><a href="Tutorial.Chapter01.Exercise02.html#Functions"><span class="hs-identifier">Functions</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Functions"><a href="Tutorial.Chapter01.Exercise02.html#Functions"><span class="hs-identifier">Functions</span></a></a><span>
</span><a name="line-103"></a><span>  </span><span class="hs-special">{</span><span> </span><a name="functions"><a href="Tutorial.Chapter01.Exercise02.html#functions"><span class="hs-identifier">functions</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Map.Map</span><span> </span><a href="Grin.Value.html#Name"><span class="hs-identifier hs-type">Grin.Name</span></a><span> </span><a href="Grin.Exp.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><span class="hs-comment">-- ^ Functions defined within the GRIN program</span><span>
</span><a name="line-104"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="externals"><a href="Tutorial.Chapter01.Exercise02.html#externals"><span class="hs-identifier">externals</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#InterpretExternal"><span class="hs-identifier hs-type">InterpretExternal</span></a><span>     </span><span class="hs-comment">-- ^ Externals used within the GRIN program</span><span>
</span><a name="line-105"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-106"></a><span>
</span><a name="line-107"></a><span>
</span><a name="line-108"></a><span class="hs-keyword">newtype</span><span> </span><a name="Definitional"><a href="Tutorial.Chapter01.Exercise02.html#Definitional"><span class="hs-identifier">Definitional</span></a></a><span> </span><a name="local-6989586621679276734"><a href="#local-6989586621679276734"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679276735"><a href="#local-6989586621679276735"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-109"></a><span>    </span><a name="Definitional"><a href="Tutorial.Chapter01.Exercise02.html#Definitional"><span class="hs-identifier">Definitional</span></a></a><span>
</span><a name="line-110"></a><span>      </span><span class="hs-special">(</span><span class="hs-identifier hs-type">RWST</span><span> </span><span class="hs-comment">-- Reader Writer State Monad Transformer</span><span>
</span><a name="line-111"></a><span>        </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#Functions"><span class="hs-identifier hs-type">Functions</span></a><span class="hs-special">,</span><span> </span><a href="Grin.Interpreter.Env.html#Env"><span class="hs-identifier hs-type">Env</span></a><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Value"><span class="hs-identifier hs-type">Value</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Reader on the Functions and the variable value mapping</span><span>
</span><a name="line-112"></a><span>        </span><span class="hs-special">(</span><span class="hs-special">)</span><span>                     </span><span class="hs-comment">-- Empty writer: No logging happens at all</span><span>
</span><a name="line-113"></a><span>        </span><span class="hs-special">(</span><a href="Grin.Interpreter.Store.html#Store"><span class="hs-identifier hs-type">Store</span></a><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Address"><span class="hs-identifier hs-type">Address</span></a><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Node"><span class="hs-identifier hs-type">Node</span></a><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- State is the Store which can be change during the interpretation</span><span>
</span><a name="line-114"></a><span>        </span><a href="#local-6989586621679276734"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-115"></a><span>        </span><a href="#local-6989586621679276735"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-116"></a><span>      </span><span class="hs-special">)</span><span>
</span><a name="line-117"></a><span>  </span><span class="hs-keyword">deriving</span><span>
</span><a name="line-118"></a><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Functor</span><span>
</span><a name="line-119"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span>
</span><a name="line-120"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monad</span><span>
</span><a name="line-121"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span>
</span><a name="line-122"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonadReader</span><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#Functions"><span class="hs-identifier hs-type">Functions</span></a><span class="hs-special">,</span><span> </span><a href="Grin.Interpreter.Env.html#Env"><span class="hs-identifier hs-type">Env</span></a><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Value"><span class="hs-identifier hs-type">Value</span></a><span class="hs-special">)</span><span>
</span><a name="line-123"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonadState</span><span> </span><span class="hs-special">(</span><a href="Grin.Interpreter.Store.html#Store"><span class="hs-identifier hs-type">Store</span></a><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Address"><span class="hs-identifier hs-type">Address</span></a><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Node"><span class="hs-identifier hs-type">Node</span></a><span class="hs-special">)</span><span>
</span><a name="line-124"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonadFail</span><span>
</span><a name="line-125"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-126"></a><span>
</span><a name="line-127"></a><span class="hs-comment">-- | Collection of the needed constraints.</span><span>
</span><a name="line-128"></a><span class="hs-keyword">type</span><span> </span><a name="DC"><a href="Tutorial.Chapter01.Exercise02.html#DC"><span class="hs-identifier">DC</span></a></a><span> </span><a name="local-6989586621679276733"><a href="#local-6989586621679276733"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679276733"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679276733"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonadFail</span><span> </span><a href="#local-6989586621679276733"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-129"></a><span>
</span><a name="line-130"></a><span class="hs-comment">{-
During the execution of a GRIN program, the interpeter
needs a context to interpret function calls.

Firstly, it needs to know all the functions defined in the GRIN program.

Furthermore, it needs to know how to call external functions (system/OS functions).
This is accomplished by `externalCall`. This function will be used to interpret
external function calls (in SApp). Given an external function's name, and the
actual arguments to the call, it calls the corresponding system/OS function.
-}</span><span>
</span><a name="line-141"></a><span>
</span><a name="line-142"></a><span class="hs-comment">-- The interpreter function gets how to interpret the external functions,</span><span>
</span><a name="line-143"></a><span class="hs-comment">-- a program to interpret, and returns a computed value.</span><span>
</span><a name="line-144"></a><span class="hs-comment">--</span><span>
</span><a name="line-145"></a><span class="hs-comment">-- It collects the function definitions from the program,</span><span>
</span><a name="line-146"></a><span class="hs-comment">-- loads the body of the main function and starts to evaluate that expression.</span><span>
</span><a name="line-147"></a><span class="hs-identifier">interpreter</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#InterpretExternal"><span class="hs-identifier hs-type">InterpretExternal</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Grin.Exp.html#Program"><span class="hs-identifier hs-type">Program</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Value"><span class="hs-identifier hs-type">Value</span></a><span>
</span><a name="line-148"></a><a name="interpreter"><a href="Tutorial.Chapter01.Exercise02.html#interpreter"><span class="hs-identifier">interpreter</span></a></a><span> </span><a name="local-6989586621679276757"><a href="#local-6989586621679276757"><span class="hs-identifier">iext</span></a></a><span> </span><a name="local-6989586621679276758"><a href="#local-6989586621679276758"><span class="hs-identifier">prog</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-149"></a><span>    </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679276759"><span class="hs-identifier hs-var">runInterpreter</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#eval"><span class="hs-identifier hs-var">eval</span></a><span> </span><span class="hs-special">(</span><a href="Grin.Exp.html#SApp"><span class="hs-identifier hs-var">SApp</span></a><span> </span><span class="hs-string">&quot;main&quot;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-150"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-151"></a><span>    </span><span class="hs-identifier">runInterpreter</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679276760"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679276760"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonadFail</span><span> </span><a href="#local-6989586621679276760"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Definitional"><span class="hs-identifier hs-type">Definitional</span></a><span> </span><a href="#local-6989586621679276760"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679276761"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679276760"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679276761"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Grin.Interpreter.Store.html#Store"><span class="hs-identifier hs-type">Store</span></a><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Address"><span class="hs-identifier hs-type">Address</span></a><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Node"><span class="hs-identifier hs-type">Node</span></a><span class="hs-special">)</span><span>
</span><a name="line-152"></a><span>    </span><a name="local-6989586621679276759"><a href="#local-6989586621679276759"><span class="hs-identifier">runInterpreter</span></a></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#Definitional"><span class="hs-identifier hs-var">Definitional</span></a><span> </span><a name="local-6989586621679276762"><a href="#local-6989586621679276762"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-153"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679276763"><a href="#local-6989586621679276763"><span class="hs-identifier">funs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Functions"><span class="hs-identifier hs-var">Functions</span></a><span> </span><span class="hs-special">(</span><a href="Grin.Exp.html#programToDefs"><span class="hs-identifier hs-var">programToDefs</span></a><span> </span><a href="#local-6989586621679276758"><span class="hs-identifier hs-var">prog</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679276757"><span class="hs-identifier hs-var">iext</span></a><span>
</span><a name="line-154"></a><span>      </span><span class="hs-special">(</span><a name="local-6989586621679276764"><a href="#local-6989586621679276764"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><a name="local-6989586621679276765"><a href="#local-6989586621679276765"><span class="hs-identifier">store</span></a></a><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">runRWST</span><span> </span><a href="#local-6989586621679276762"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679276763"><span class="hs-identifier hs-var">funs</span></a><span class="hs-special">,</span><span> </span><a href="Grin.Interpreter.Env.html#empty"><span class="hs-identifier hs-var">Env.empty</span></a><span class="hs-special">)</span><span> </span><a href="Grin.Interpreter.Store.html#empty"><span class="hs-identifier hs-var">Store.empty</span></a><span>
</span><a name="line-155"></a><span>      </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679276764"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><a href="#local-6989586621679276765"><span class="hs-identifier hs-var">store</span></a><span class="hs-special">)</span><span>
</span><a name="line-156"></a><span>
</span><a name="line-157"></a><span class="hs-comment">-- * Implementation details</span><span>
</span><a name="line-158"></a><span>
</span><a name="line-159"></a><span class="hs-comment">-- | Turns a Simple Value from a syntax to a simple value of the semantics.</span><span>
</span><a name="line-160"></a><span class="hs-identifier">simpleValue</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Grin.Value.html#SimpleValue"><span class="hs-identifier hs-type">Grin.SimpleValue</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#SValue"><span class="hs-identifier hs-type">SValue</span></a><span>
</span><a name="line-161"></a><a name="simpleValue"><a href="Tutorial.Chapter01.Exercise02.html#simpleValue"><span class="hs-identifier">simpleValue</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-162"></a><span>  </span><a href="Grin.Value.html#SInt64"><span class="hs-identifier hs-var">Grin.SInt64</span></a><span>  </span><a name="local-6989586621679276766"><a href="#local-6989586621679276766"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#SInt64"><span class="hs-identifier hs-var">SInt64</span></a><span>  </span><a href="#local-6989586621679276766"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-163"></a><span>  </span><a href="Grin.Value.html#SWord64"><span class="hs-identifier hs-var">Grin.SWord64</span></a><span> </span><a name="local-6989586621679276767"><a href="#local-6989586621679276767"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#SWord64"><span class="hs-identifier hs-var">SWord64</span></a><span> </span><a href="#local-6989586621679276767"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-164"></a><span>  </span><a href="Grin.Value.html#SFloat"><span class="hs-identifier hs-var">Grin.SFloat</span></a><span>  </span><a name="local-6989586621679276768"><a href="#local-6989586621679276768"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#SFloat"><span class="hs-identifier hs-var">SFloat</span></a><span>  </span><a href="#local-6989586621679276768"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-165"></a><span>  </span><a href="Grin.Value.html#SBool"><span class="hs-identifier hs-var">Grin.SBool</span></a><span>   </span><a name="local-6989586621679276769"><a href="#local-6989586621679276769"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#SBool"><span class="hs-identifier hs-var">SBool</span></a><span>   </span><a href="#local-6989586621679276769"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-166"></a><span>  </span><a href="Grin.Value.html#SChar"><span class="hs-identifier hs-var">Grin.SChar</span></a><span>   </span><a name="local-6989586621679276770"><a href="#local-6989586621679276770"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#SChar"><span class="hs-identifier hs-var">SChar</span></a><span>   </span><a href="#local-6989586621679276770"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-167"></a><span>
</span><a name="line-168"></a><span class="hs-comment">-- | Looks up a name from the active frame/environment and returns its value.</span><span>
</span><a name="line-169"></a><span class="hs-identifier">valueOf</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#DC"><span class="hs-identifier hs-type">DC</span></a><span> </span><a href="#local-6989586621679276756"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Grin.Value.html#Name"><span class="hs-identifier hs-type">Grin.Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Definitional"><span class="hs-identifier hs-type">Definitional</span></a><span> </span><a href="#local-6989586621679276756"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Value"><span class="hs-identifier hs-type">Value</span></a><span>
</span><a name="line-170"></a><a name="valueOf"><a href="Tutorial.Chapter01.Exercise02.html#valueOf"><span class="hs-identifier">valueOf</span></a></a><span> </span><a name="local-6989586621679276771"><a href="#local-6989586621679276771"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">asks</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">`</span><a href="Grin.Interpreter.Env.html#lookup"><span class="hs-identifier hs-var">Env.lookup</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679276771"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">snd</span><span class="hs-special">)</span><span>
</span><a name="line-171"></a><span>
</span><a name="line-172"></a><span class="hs-comment">-- | Looks up a name from the active frame/environment and returns its value, expecting a simple value.</span><span>
</span><a name="line-173"></a><span class="hs-identifier">svalueOf</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#DC"><span class="hs-identifier hs-type">DC</span></a><span> </span><a href="#local-6989586621679276755"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Grin.Value.html#Name"><span class="hs-identifier hs-type">Grin.Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Definitional"><span class="hs-identifier hs-type">Definitional</span></a><span> </span><a href="#local-6989586621679276755"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Tutorial.Chapter01.Exercise02.html#SValue"><span class="hs-identifier hs-type">SValue</span></a><span>
</span><a name="line-174"></a><a name="svalueOf"><a href="Tutorial.Chapter01.Exercise02.html#svalueOf"><span class="hs-identifier">svalueOf</span></a></a><span> </span><a name="local-6989586621679276772"><a href="#local-6989586621679276772"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-175"></a><span>  </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#Prim"><span class="hs-identifier hs-var">Prim</span></a><span> </span><a name="local-6989586621679276773"><a href="#local-6989586621679276773"><span class="hs-identifier">sv</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#valueOf"><span class="hs-identifier hs-var">valueOf</span></a><span> </span><a href="#local-6989586621679276772"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-176"></a><span>  </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679276773"><span class="hs-identifier hs-var">sv</span></a><span>
</span><a name="line-177"></a><span>
</span><a name="line-178"></a><span class="hs-comment">-- | Creates a new location that can be used in the Store operation.</span><span>
</span><a name="line-179"></a><span class="hs-comment">-- The size of the underlying Map will be always the last created location +1,</span><span>
</span><a name="line-180"></a><span class="hs-comment">-- which serves the purpose of a new address.</span><span>
</span><a name="line-181"></a><span class="hs-identifier">alloc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#DC"><span class="hs-identifier hs-type">DC</span></a><span> </span><a href="#local-6989586621679276754"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Definitional"><span class="hs-identifier hs-type">Definitional</span></a><span> </span><a href="#local-6989586621679276754"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Address"><span class="hs-identifier hs-type">Address</span></a><span>
</span><a name="line-182"></a><a name="alloc"><a href="Tutorial.Chapter01.Exercise02.html#alloc"><span class="hs-identifier">alloc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">gets</span><span> </span><a href="Grin.Interpreter.Store.html#size"><span class="hs-identifier hs-var">Store.size</span></a><span>
</span><a name="line-183"></a><span>
</span><a name="line-184"></a><span class="hs-comment">-- The Eval function, that operates on the Expression part of the GRIN AST.</span><span>
</span><a name="line-185"></a><span class="hs-identifier">eval</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#DC"><span class="hs-identifier hs-type">DC</span></a><span> </span><a href="#local-6989586621679276753"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Grin.Exp.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Definitional"><span class="hs-identifier hs-type">Definitional</span></a><span> </span><a href="#local-6989586621679276753"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Value"><span class="hs-identifier hs-type">Value</span></a><span>
</span><a name="line-186"></a><a name="eval"><a href="Tutorial.Chapter01.Exercise02.html#eval"><span class="hs-identifier">eval</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-187"></a><span>  </span><span class="hs-comment">-- Evaluates the given value, assigning a semantical value to a syntactical one.</span><span>
</span><a name="line-188"></a><span>  </span><a href="Grin.Exp.html#SPure"><span class="hs-identifier hs-var">SPure</span></a><span> </span><span class="hs-special">(</span><a href="Grin.Value.html#Val"><span class="hs-identifier hs-var">Grin.Val</span></a><span> </span><a name="local-6989586621679276774"><a href="#local-6989586621679276774"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#value"><span class="hs-identifier hs-var">value</span></a><span> </span><a href="#local-6989586621679276774"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-189"></a><span>
</span><a name="line-190"></a><span>  </span><span class="hs-comment">-- Looks up a variable form the active environment</span><span>
</span><a name="line-191"></a><span>  </span><a href="Grin.Exp.html#SPure"><span class="hs-identifier hs-var">SPure</span></a><span> </span><span class="hs-special">(</span><a href="Grin.Value.html#Var"><span class="hs-identifier hs-var">Grin.Var</span></a><span> </span><a name="local-6989586621679276775"><a href="#local-6989586621679276775"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-192"></a><span>    </span><a name="local-6989586621679276776"><a href="#local-6989586621679276776"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#askEnv"><span class="hs-identifier hs-var">askEnv</span></a><span>
</span><a name="line-193"></a><span>    </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Grin.Interpreter.Env.html#lookup"><span class="hs-identifier hs-var">Env.lookup</span></a><span> </span><a href="#local-6989586621679276776"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679276775"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-194"></a><span>
</span><a name="line-195"></a><span>  </span><span class="hs-comment">-- Calls a function, external or GRIN defined internal.</span><span>
</span><a name="line-196"></a><span>  </span><a href="Grin.Exp.html#SApp"><span class="hs-identifier hs-var">SApp</span></a><span> </span><a name="local-6989586621679276777"><a href="#local-6989586621679276777"><span class="hs-identifier">fn</span></a></a><span> </span><a name="local-6989586621679276778"><a href="#local-6989586621679276778"><span class="hs-identifier">ps</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-197"></a><span>    </span><a name="local-6989586621679276779"><a href="#local-6989586621679276779"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#askEnv"><span class="hs-identifier hs-var">askEnv</span></a><span>
</span><a name="line-198"></a><span>    </span><a name="local-6989586621679276780"><a href="#local-6989586621679276780"><span class="hs-identifier">vs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="Grin.Interpreter.Env.html#lookup"><span class="hs-identifier hs-var">Env.lookup</span></a><span> </span><a href="#local-6989586621679276779"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679276778"><span class="hs-identifier hs-var">ps</span></a><span>
</span><a name="line-199"></a><span>    </span><a name="local-6989586621679276781"><a href="#local-6989586621679276781"><span class="hs-identifier">ext</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#isExternal"><span class="hs-identifier hs-var">isExternal</span></a><span> </span><a href="#local-6989586621679276777"><span class="hs-identifier hs-var">fn</span></a><span>
</span><a name="line-200"></a><span>    </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679276781"><span class="hs-identifier hs-var">ext</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#external"><span class="hs-identifier hs-var">external</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#funCall"><span class="hs-identifier hs-var">funCall</span></a><span> </span><a href="Tutorial.Chapter01.Exercise02.html#eval"><span class="hs-identifier hs-var">eval</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679276777"><span class="hs-identifier hs-var">fn</span></a><span> </span><a href="#local-6989586621679276780"><span class="hs-identifier hs-var">vs</span></a><span>
</span><a name="line-201"></a><span>
</span><a name="line-202"></a><span>  </span><span class="hs-comment">-- Fetches a value from the heap.</span><span>
</span><a name="line-203"></a><span>  </span><a href="Grin.Exp.html#SFetch"><span class="hs-identifier hs-var">SFetch</span></a><span> </span><a name="local-6989586621679276782"><a href="#local-6989586621679276782"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-204"></a><span>    </span><a name="local-6989586621679276783"><a href="#local-6989586621679276783"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#askEnv"><span class="hs-identifier hs-var">askEnv</span></a><span>
</span><a name="line-205"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679276784"><a href="#local-6989586621679276784"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Grin.Interpreter.Env.html#lookup"><span class="hs-identifier hs-var">Env.lookup</span></a><span> </span><a href="#local-6989586621679276783"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679276782"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-206"></a><span>    </span><a href="Tutorial.Chapter01.Exercise02.html#fetchStore"><span class="hs-identifier hs-var">fetchStore</span></a><span> </span><a href="#local-6989586621679276784"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-207"></a><span>
</span><a name="line-208"></a><span>  </span><span class="hs-comment">-- Updates the given location with the given value.</span><span>
</span><a name="line-209"></a><span>  </span><a href="Grin.Exp.html#SUpdate"><span class="hs-identifier hs-var">SUpdate</span></a><span> </span><a name="local-6989586621679276785"><a href="#local-6989586621679276785"><span class="hs-identifier">nl</span></a></a><span> </span><a name="local-6989586621679276786"><a href="#local-6989586621679276786"><span class="hs-identifier">nn</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-210"></a><span>    </span><a name="local-6989586621679276787"><a href="#local-6989586621679276787"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#askEnv"><span class="hs-identifier hs-var">askEnv</span></a><span>
</span><a name="line-211"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679276788"><a href="#local-6989586621679276788"><span class="hs-identifier">vl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Grin.Interpreter.Env.html#lookup"><span class="hs-identifier hs-var">Env.lookup</span></a><span> </span><a href="#local-6989586621679276787"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679276785"><span class="hs-identifier hs-var">nl</span></a><span>
</span><a name="line-212"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679276789"><a href="#local-6989586621679276789"><span class="hs-identifier">vn</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Grin.Interpreter.Env.html#lookup"><span class="hs-identifier hs-var">Env.lookup</span></a><span> </span><a href="#local-6989586621679276787"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679276786"><span class="hs-identifier hs-var">nn</span></a><span>
</span><a name="line-213"></a><span>    </span><a href="Tutorial.Chapter01.Exercise02.html#extStore"><span class="hs-identifier hs-var">extStore</span></a><span> </span><a href="#local-6989586621679276788"><span class="hs-identifier hs-var">vl</span></a><span> </span><a href="#local-6989586621679276789"><span class="hs-identifier hs-var">vn</span></a><span>
</span><a name="line-214"></a><span>    </span><span class="hs-keyword">unit</span><span>
</span><a name="line-215"></a><span>
</span><a name="line-216"></a><span>  </span><span class="hs-comment">-- Matches the given value with one of the alternatives.</span><span>
</span><a name="line-217"></a><span>  </span><a href="Grin.Exp.html#ECase"><span class="hs-identifier hs-var">ECase</span></a><span> </span><a name="local-6989586621679276790"><a href="#local-6989586621679276790"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679276791"><a href="#local-6989586621679276791"><span class="hs-identifier">alts</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-218"></a><span>    </span><a name="local-6989586621679276792"><a href="#local-6989586621679276792"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#askEnv"><span class="hs-identifier hs-var">askEnv</span></a><span>
</span><a name="line-219"></a><span>    </span><a name="local-6989586621679276793"><a href="#local-6989586621679276793"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Grin.Interpreter.Env.html#lookup"><span class="hs-identifier hs-var">Env.lookup</span></a><span> </span><a href="#local-6989586621679276792"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679276790"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-220"></a><span>    </span><span class="hs-comment">-- Select the alternative and continue the evaluation</span><span>
</span><a name="line-221"></a><span>    </span><a href="Tutorial.Chapter01.Exercise02.html#evalCase"><span class="hs-identifier hs-var">evalCase</span></a><span> </span><a href="Tutorial.Chapter01.Exercise02.html#eval"><span class="hs-identifier hs-var">eval</span></a><span> </span><a href="#local-6989586621679276793"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621679276791"><span class="hs-identifier hs-var">alts</span></a><span>
</span><a name="line-222"></a><span>
</span><a name="line-223"></a><span>  </span><span class="hs-comment">-- Handling stores are differen. Create a new location, saves the given node value</span><span>
</span><a name="line-224"></a><span>  </span><span class="hs-comment">-- to the location, and assignes the created location value to the variable in the Bind pattern.</span><span>
</span><a name="line-225"></a><span>  </span><a href="Grin.Exp.html#EBind"><span class="hs-identifier hs-var">EBind</span></a><span> </span><span class="hs-special">(</span><a href="Grin.Exp.html#SStore"><span class="hs-identifier hs-var">SStore</span></a><span> </span><a name="local-6989586621679276794"><a href="#local-6989586621679276794"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Grin.Exp.html#BVar"><span class="hs-identifier hs-var">BVar</span></a><span> </span><a name="local-6989586621679276795"><a href="#local-6989586621679276795"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679276796"><a href="#local-6989586621679276796"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-226"></a><span>    </span><a name="local-6989586621679276797"><a href="#local-6989586621679276797"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#askEnv"><span class="hs-identifier hs-var">askEnv</span></a><span>
</span><a name="line-227"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679276798"><a href="#local-6989586621679276798"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Grin.Interpreter.Env.html#lookup"><span class="hs-identifier hs-var">Env.lookup</span></a><span> </span><a href="#local-6989586621679276797"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679276794"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-228"></a><span>    </span><a name="local-6989586621679276799"><a href="#local-6989586621679276799"><span class="hs-identifier">a</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#allocStore"><span class="hs-identifier hs-var">allocStore</span></a><span> </span><a href="#local-6989586621679276795"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-229"></a><span>    </span><a href="Tutorial.Chapter01.Exercise02.html#extStore"><span class="hs-identifier hs-var">extStore</span></a><span> </span><a href="#local-6989586621679276799"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679276798"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-230"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679276800"><a href="#local-6989586621679276800"><span class="hs-identifier">p'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Grin.Interpreter.Env.html#insert"><span class="hs-identifier hs-var">Env.insert</span></a><span> </span><a href="#local-6989586621679276795"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679276799"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679276797"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-231"></a><span>    </span><a href="Tutorial.Chapter01.Exercise02.html#localEnv"><span class="hs-identifier hs-var">localEnv</span></a><span> </span><a href="#local-6989586621679276800"><span class="hs-identifier hs-var">p'</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#eval"><span class="hs-identifier hs-var">eval</span></a><span> </span><a href="#local-6989586621679276796"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-232"></a><span>
</span><a name="line-233"></a><span>  </span><span class="hs-comment">-- Evaluates the left expression, than evaluates the right expression, returns the</span><span>
</span><a name="line-234"></a><span>  </span><span class="hs-comment">-- value of the right.</span><span>
</span><a name="line-235"></a><span>  </span><a href="Grin.Exp.html#EBind"><span class="hs-identifier hs-var">EBind</span></a><span> </span><a name="local-6989586621679276801"><a href="#local-6989586621679276801"><span class="hs-identifier">lhs</span></a></a><span> </span><a href="Grin.Exp.html#BUnit"><span class="hs-identifier hs-var">BUnit</span></a><span> </span><a name="local-6989586621679276802"><a href="#local-6989586621679276802"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-236"></a><span>    </span><span class="hs-identifier hs-var">void</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#eval"><span class="hs-identifier hs-var">eval</span></a><span> </span><a href="#local-6989586621679276801"><span class="hs-identifier hs-var">lhs</span></a><span>
</span><a name="line-237"></a><span>    </span><a href="Tutorial.Chapter01.Exercise02.html#eval"><span class="hs-identifier hs-var">eval</span></a><span> </span><a href="#local-6989586621679276802"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-238"></a><span>
</span><a name="line-239"></a><span>  </span><span class="hs-comment">-- Evaluates the left expression, than binds its return value to the variable</span><span>
</span><a name="line-240"></a><span>  </span><span class="hs-comment">-- extending the environment, run the right epxression with the extended</span><span>
</span><a name="line-241"></a><span>  </span><span class="hs-comment">-- environemnt and returns its value.</span><span>
</span><a name="line-242"></a><span>  </span><a href="Grin.Exp.html#EBind"><span class="hs-identifier hs-var">EBind</span></a><span> </span><a name="local-6989586621679276803"><a href="#local-6989586621679276803"><span class="hs-identifier">lhs</span></a></a><span> </span><span class="hs-special">(</span><a href="Grin.Exp.html#BVar"><span class="hs-identifier hs-var">BVar</span></a><span> </span><a name="local-6989586621679276804"><a href="#local-6989586621679276804"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679276805"><a href="#local-6989586621679276805"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-243"></a><span>    </span><a name="local-6989586621679276806"><a href="#local-6989586621679276806"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#eval"><span class="hs-identifier hs-var">eval</span></a><span> </span><a href="#local-6989586621679276803"><span class="hs-identifier hs-var">lhs</span></a><span>
</span><a name="line-244"></a><span>    </span><a name="local-6989586621679276807"><a href="#local-6989586621679276807"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#askEnv"><span class="hs-identifier hs-var">askEnv</span></a><span>
</span><a name="line-245"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679276808"><a href="#local-6989586621679276808"><span class="hs-identifier">p'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Grin.Interpreter.Env.html#insert"><span class="hs-identifier hs-var">Env.insert</span></a><span> </span><a href="#local-6989586621679276804"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679276806"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621679276807"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-246"></a><span>    </span><a href="Tutorial.Chapter01.Exercise02.html#localEnv"><span class="hs-identifier hs-var">localEnv</span></a><span> </span><a href="#local-6989586621679276808"><span class="hs-identifier hs-var">p'</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#eval"><span class="hs-identifier hs-var">eval</span></a><span> </span><a href="#local-6989586621679276805"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">)</span><span>
</span><a name="line-247"></a><span>
</span><a name="line-248"></a><span>  </span><span class="hs-comment">-- Evaluates the left expression, than binds its return value to the variables</span><span>
</span><a name="line-249"></a><span>  </span><span class="hs-comment">-- in the bind pattern if the tag of the computed value matches,</span><span>
</span><a name="line-250"></a><span>  </span><span class="hs-comment">-- extending the environment, run the right epxression with the extended</span><span>
</span><a name="line-251"></a><span>  </span><span class="hs-comment">-- environemnt and returns its value.</span><span>
</span><a name="line-252"></a><span>  </span><a href="Grin.Exp.html#EBind"><span class="hs-identifier hs-var">EBind</span></a><span> </span><a name="local-6989586621679276809"><a href="#local-6989586621679276809"><span class="hs-identifier">lhs</span></a></a><span> </span><span class="hs-special">(</span><a href="Grin.Exp.html#BNodePat"><span class="hs-identifier hs-var">BNodePat</span></a><span> </span><a name="local-6989586621679276810"><a href="#local-6989586621679276810"><span class="hs-identifier">t</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Grin.Value.html#Tag"><span class="hs-identifier hs-var">Grin.Tag</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679276811"><a href="#local-6989586621679276811"><span class="hs-identifier">vs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679276812"><a href="#local-6989586621679276812"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-253"></a><span>    </span><a name="local-6989586621679276813"><a href="#local-6989586621679276813"><span class="hs-identifier">v</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#eval"><span class="hs-identifier hs-var">eval</span></a><span> </span><a href="#local-6989586621679276809"><span class="hs-identifier hs-var">lhs</span></a><span>
</span><a name="line-254"></a><span>    </span><a name="local-6989586621679276814"><a href="#local-6989586621679276814"><span class="hs-identifier">p</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#askEnv"><span class="hs-identifier hs-var">askEnv</span></a><span>
</span><a name="line-255"></a><span>    </span><a name="local-6989586621679276815"><a href="#local-6989586621679276815"><span class="hs-identifier">p'</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">flip</span><span> </span><a href="Grin.Interpreter.Env.html#inserts"><span class="hs-identifier hs-var">Env.inserts</span></a><span> </span><a href="#local-6989586621679276814"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#bindPattern"><span class="hs-identifier hs-var">bindPattern</span></a><span> </span><a href="#local-6989586621679276813"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679276810"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">,</span><a href="#local-6989586621679276811"><span class="hs-identifier hs-var">vs</span></a><span class="hs-special">)</span><span>
</span><a name="line-256"></a><span>    </span><a href="Tutorial.Chapter01.Exercise02.html#localEnv"><span class="hs-identifier hs-var">localEnv</span></a><span> </span><a href="#local-6989586621679276815"><span class="hs-identifier hs-var">p'</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#eval"><span class="hs-identifier hs-var">eval</span></a><span> </span><a href="#local-6989586621679276812"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">)</span><span>
</span><a name="line-257"></a><span>
</span><a name="line-258"></a><span>  </span><span class="hs-comment">-- After the Case selected the Alternative it just needs to evaluate its body.</span><span>
</span><a name="line-259"></a><span>  </span><a href="Grin.Exp.html#Alt"><span class="hs-identifier hs-var">Alt</span></a><span> </span><a name="local-6989586621679276816"><a href="#local-6989586621679276816"><span class="hs-identifier">_pat</span></a></a><span> </span><a name="local-6989586621679276817"><a href="#local-6989586621679276817"><span class="hs-identifier">body</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-260"></a><span>    </span><a href="Tutorial.Chapter01.Exercise02.html#eval"><span class="hs-identifier hs-var">eval</span></a><span> </span><a href="#local-6989586621679276817"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-261"></a><span>
</span><a name="line-262"></a><span>  </span><a name="local-6989586621679276818"><a href="#local-6989586621679276818"><span class="hs-identifier">overGenerative</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679276818"><span class="hs-identifier hs-var">overGenerative</span></a><span>
</span><a name="line-263"></a><span>
</span><a name="line-264"></a><span>
</span><a name="line-265"></a><span class="hs-comment">-- | How to turn a source defined value to a runtime value</span><span>
</span><a name="line-266"></a><span class="hs-identifier">value</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#DC"><span class="hs-identifier hs-type">DC</span></a><span> </span><a href="#local-6989586621679276752"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Grin.Value.html#Value"><span class="hs-identifier hs-type">Grin.Value</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Definitional"><span class="hs-identifier hs-type">Definitional</span></a><span> </span><a href="#local-6989586621679276752"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Value"><span class="hs-identifier hs-type">Value</span></a><span>
</span><a name="line-267"></a><a name="value"><a href="Tutorial.Chapter01.Exercise02.html#value"><span class="hs-identifier">value</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-268"></a><span>  </span><a href="Grin.Value.html#VPrim"><span class="hs-identifier hs-var">Grin.VPrim</span></a><span> </span><a name="local-6989586621679276819"><a href="#local-6989586621679276819"><span class="hs-identifier">sval</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Prim"><span class="hs-identifier hs-var">Prim</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#simpleValue"><span class="hs-identifier hs-var">simpleValue</span></a><span> </span><a href="#local-6989586621679276819"><span class="hs-identifier hs-var">sval</span></a><span>
</span><a name="line-269"></a><span>  </span><span class="hs-comment">-- Exercise: Node can refer to names, lookup the names from</span><span>
</span><a name="line-270"></a><span>  </span><span class="hs-comment">-- the environment and create a runtime Node value from</span><span>
</span><a name="line-271"></a><span>  </span><span class="hs-comment">-- the value that was defined in the source.</span><span>
</span><a name="line-272"></a><span>  </span><a href="Grin.Value.html#VNode"><span class="hs-identifier hs-var">Grin.VNode</span></a><span> </span><a name="local-6989586621679276820"><a href="#local-6989586621679276820"><span class="hs-identifier">vnode</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">undefined</span><span> </span><a href="#local-6989586621679276820"><span class="hs-identifier hs-var">vnode</span></a><span>
</span><a name="line-273"></a><span>
</span><a name="line-274"></a><span class="hs-comment">-- | Convert a runtime value to an address value</span><span>
</span><a name="line-275"></a><span class="hs-identifier">val2addr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#DC"><span class="hs-identifier hs-type">DC</span></a><span> </span><a href="#local-6989586621679276751"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Value"><span class="hs-identifier hs-type">Value</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Definitional"><span class="hs-identifier hs-type">Definitional</span></a><span> </span><a href="#local-6989586621679276751"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Address"><span class="hs-identifier hs-type">Address</span></a><span>
</span><a name="line-276"></a><a name="val2addr"><a href="Tutorial.Chapter01.Exercise02.html#val2addr"><span class="hs-identifier">val2addr</span></a></a><span> </span><a name="local-6989586621679276821"><a href="#local-6989586621679276821"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-277"></a><span>  </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#Prim"><span class="hs-identifier hs-var">Prim</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#SLoc"><span class="hs-identifier hs-var">SLoc</span></a><span> </span><a name="local-6989586621679276822"><a href="#local-6989586621679276822"><span class="hs-identifier">addr</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679276821"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-278"></a><span>  </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679276822"><span class="hs-identifier hs-var">addr</span></a><span>
</span><a name="line-279"></a><span>
</span><a name="line-280"></a><span class="hs-comment">-- | Convert an address value to a runtime value.</span><span>
</span><a name="line-281"></a><span class="hs-identifier">addr2val</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#DC"><span class="hs-identifier hs-type">DC</span></a><span> </span><a href="#local-6989586621679276750"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Address"><span class="hs-identifier hs-type">Address</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Definitional"><span class="hs-identifier hs-type">Definitional</span></a><span> </span><a href="#local-6989586621679276750"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Value"><span class="hs-identifier hs-type">Value</span></a><span>
</span><a name="line-282"></a><a name="addr2val"><a href="Tutorial.Chapter01.Exercise02.html#addr2val"><span class="hs-identifier">addr2val</span></a></a><span> </span><a name="local-6989586621679276823"><a href="#local-6989586621679276823"><span class="hs-identifier">addr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#Prim"><span class="hs-identifier hs-var">Prim</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#SLoc"><span class="hs-identifier hs-var">SLoc</span></a><span> </span><a href="#local-6989586621679276823"><span class="hs-identifier hs-var">addr</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-283"></a><span>
</span><a name="line-284"></a><span class="hs-comment">-- | Convert a heap value, which is a node to a runtime value</span><span>
</span><a name="line-285"></a><span class="hs-identifier">heapVal2val</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#DC"><span class="hs-identifier hs-type">DC</span></a><span> </span><a href="#local-6989586621679276749"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Node"><span class="hs-identifier hs-type">Node</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Definitional"><span class="hs-identifier hs-type">Definitional</span></a><span> </span><a href="#local-6989586621679276749"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Value"><span class="hs-identifier hs-type">Value</span></a><span>
</span><a name="line-286"></a><a name="heapVal2val"><a href="Tutorial.Chapter01.Exercise02.html#heapVal2val"><span class="hs-identifier">heapVal2val</span></a></a><span> </span><a name="local-6989586621679276824"><a href="#local-6989586621679276824"><span class="hs-identifier">node</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a href="#local-6989586621679276824"><span class="hs-identifier hs-var">node</span></a><span class="hs-special">)</span><span>
</span><a name="line-287"></a><span>
</span><a name="line-288"></a><span class="hs-comment">-- | Convert a runtime value to a Node value</span><span>
</span><a name="line-289"></a><span class="hs-identifier">val2heapVal</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#DC"><span class="hs-identifier hs-type">DC</span></a><span> </span><a href="#local-6989586621679276748"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Value"><span class="hs-identifier hs-type">Value</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Definitional"><span class="hs-identifier hs-type">Definitional</span></a><span> </span><a href="#local-6989586621679276748"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Node"><span class="hs-identifier hs-type">Node</span></a><span>
</span><a name="line-290"></a><a name="val2heapVal"><a href="Tutorial.Chapter01.Exercise02.html#val2heapVal"><span class="hs-identifier">val2heapVal</span></a></a><span> </span><a name="local-6989586621679276825"><a href="#local-6989586621679276825"><span class="hs-identifier">val</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-291"></a><span>  </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#Node"><span class="hs-identifier hs-var">Node</span></a><span> </span><a name="local-6989586621679276826"><a href="#local-6989586621679276826"><span class="hs-identifier">node</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679276825"><span class="hs-identifier hs-var">val</span></a><span>
</span><a name="line-292"></a><span>  </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679276826"><span class="hs-identifier hs-var">node</span></a><span>
</span><a name="line-293"></a><span>
</span><a name="line-294"></a><span class="hs-comment">-- | Creates the Unit value, which is only created when the Update operation runs.</span><span>
</span><a name="line-295"></a><span class="hs-keyword">unit</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#DC"><span class="hs-identifier hs-type">DC</span></a><span> </span><a href="#local-6989586621679276747"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Definitional"><span class="hs-identifier hs-type">Definitional</span></a><span> </span><a href="#local-6989586621679276747"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Value"><span class="hs-identifier hs-type">Value</span></a><span>
</span><a name="line-296"></a><span class="hs-keyword">unit</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Unit"><span class="hs-identifier hs-var">Unit</span></a><span>
</span><a name="line-297"></a><span>
</span><a name="line-298"></a><span class="hs-comment">-- | Creates a list of Name and runtime value pairs which extends the environment for the</span><span>
</span><a name="line-299"></a><span class="hs-comment">-- right hand side of the bind.</span><span>
</span><a name="line-300"></a><span class="hs-comment">-- See in lazyAdd or in sumSimple</span><span>
</span><a name="line-301"></a><span class="hs-identifier">bindPattern</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#DC"><span class="hs-identifier hs-type">DC</span></a><span> </span><a href="#local-6989586621679276746"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Value"><span class="hs-identifier hs-type">Value</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Grin.Value.html#Tag"><span class="hs-identifier hs-type">Grin.Tag</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Grin.Value.html#Name"><span class="hs-identifier hs-type">Grin.Name</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Definitional"><span class="hs-identifier hs-type">Definitional</span></a><span> </span><a href="#local-6989586621679276746"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Grin.Value.html#Name"><span class="hs-identifier hs-type">Grin.Name</span></a><span class="hs-special">,</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Value"><span class="hs-identifier hs-type">Value</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-302"></a><a name="bindPattern"><a href="Tutorial.Chapter01.Exercise02.html#bindPattern"><span class="hs-identifier">bindPattern</span></a></a><span> </span><a name="local-6989586621679276827"><a href="#local-6989586621679276827"><span class="hs-identifier">val</span></a></a><span> </span><a name="local-6989586621679276828"><a href="#local-6989586621679276828"><span class="hs-identifier">tags</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-303"></a><span>  </span><span class="hs-comment">-- Exercise: The val should be a Node value, if the tag of the node matches, with the given</span><span>
</span><a name="line-304"></a><span>  </span><span class="hs-comment">-- tag, than the args argument from the Node value must be paired with the names in the</span><span>
</span><a name="line-305"></a><span>  </span><span class="hs-comment">-- given pattern.</span><span>
</span><a name="line-306"></a><span>  </span><span class="hs-comment">-- TODO: Add reference to the examples.</span><span>
</span><a name="line-307"></a><span>  </span><span class="hs-identifier hs-var">undefined</span><span>
</span><a name="line-308"></a><span>
</span><a name="line-309"></a><span class="hs-comment">-- | Return the environment, which associates  names with values</span><span>
</span><a name="line-310"></a><span class="hs-identifier">askEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#DC"><span class="hs-identifier hs-type">DC</span></a><span> </span><a href="#local-6989586621679276745"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Definitional"><span class="hs-identifier hs-type">Definitional</span></a><span> </span><a href="#local-6989586621679276745"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Grin.Interpreter.Env.html#Env"><span class="hs-identifier hs-type">Env</span></a><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Value"><span class="hs-identifier hs-type">Value</span></a><span class="hs-special">)</span><span>
</span><a name="line-311"></a><a name="askEnv"><a href="Tutorial.Chapter01.Exercise02.html#askEnv"><span class="hs-identifier">askEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">asks</span><span> </span><span class="hs-identifier hs-var">snd</span><span>
</span><a name="line-312"></a><span>
</span><a name="line-313"></a><span class="hs-comment">-- | Sets the environment to the given one, this is for binds, function calls,</span><span>
</span><a name="line-314"></a><span class="hs-comment">-- and alternatives.</span><span>
</span><a name="line-315"></a><span class="hs-identifier">localEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#DC"><span class="hs-identifier hs-type">DC</span></a><span> </span><a href="#local-6989586621679276744"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Grin.Interpreter.Env.html#Env"><span class="hs-identifier hs-type">Env</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#Value"><span class="hs-identifier hs-type">Value</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Definitional"><span class="hs-identifier hs-type">Definitional</span></a><span> </span><a href="#local-6989586621679276744"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Value"><span class="hs-identifier hs-type">Value</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Definitional"><span class="hs-identifier hs-type">Definitional</span></a><span> </span><a href="#local-6989586621679276744"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Value"><span class="hs-identifier hs-type">Value</span></a><span>
</span><a name="line-316"></a><a name="localEnv"><a href="Tutorial.Chapter01.Exercise02.html#localEnv"><span class="hs-identifier">localEnv</span></a></a><span> </span><a name="local-6989586621679276829"><a href="#local-6989586621679276829"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">local</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">set</span><span> </span><span class="hs-identifier hs-var">_2</span><span> </span><a href="#local-6989586621679276829"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span>
</span><a name="line-317"></a><span>
</span><a name="line-318"></a><span class="hs-comment">-- | Lookup a function by its name. It should return the Def constructor which contains</span><span>
</span><a name="line-319"></a><span class="hs-comment">-- the parameters and the body of the function.</span><span>
</span><a name="line-320"></a><span class="hs-identifier">lookupFun</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#DC"><span class="hs-identifier hs-type">DC</span></a><span> </span><a href="#local-6989586621679276743"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Grin.Value.html#Name"><span class="hs-identifier hs-type">Grin.Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Definitional"><span class="hs-identifier hs-type">Definitional</span></a><span> </span><a href="#local-6989586621679276743"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Grin.Exp.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span>
</span><a name="line-321"></a><a name="lookupFun"><a href="Tutorial.Chapter01.Exercise02.html#lookupFun"><span class="hs-identifier">lookupFun</span></a></a><span> </span><a name="local-6989586621679276830"><a href="#local-6989586621679276830"><span class="hs-identifier">funName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromJust</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">view</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">_1</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">to</span><span> </span><span class="hs-identifier">functions</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">at</span><span> </span><a href="#local-6989586621679276830"><span class="hs-identifier hs-var">funName</span></a><span class="hs-special">)</span><span>
</span><a name="line-322"></a><span>
</span><a name="line-323"></a><span class="hs-comment">-- | Checks if the given name refers to an external function.</span><span>
</span><a name="line-324"></a><span class="hs-identifier">isExternal</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#DC"><span class="hs-identifier hs-type">DC</span></a><span> </span><a href="#local-6989586621679276742"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Grin.Value.html#Name"><span class="hs-identifier hs-type">Grin.Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Definitional"><span class="hs-identifier hs-type">Definitional</span></a><span> </span><a href="#local-6989586621679276742"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-325"></a><a name="isExternal"><a href="Tutorial.Chapter01.Exercise02.html#isExternal"><span class="hs-identifier">isExternal</span></a></a><span> </span><a name="local-6989586621679276831"><a href="#local-6989586621679276831"><span class="hs-identifier">extName</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-326"></a><span>  </span><span class="hs-comment">-- Exercise: Use MonadReader to retrieve the Context and lookup the</span><span>
</span><a name="line-327"></a><span>  </span><span class="hs-comment">-- the extName in the context</span><span>
</span><a name="line-328"></a><span>  </span><span class="hs-identifier hs-var">undefined</span><span>
</span><a name="line-329"></a><span>
</span><a name="line-330"></a><span class="hs-comment">-- | Run the given external with the parameters</span><span>
</span><a name="line-331"></a><span class="hs-identifier">external</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#DC"><span class="hs-identifier hs-type">DC</span></a><span> </span><a href="#local-6989586621679276741"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Grin.Value.html#Name"><span class="hs-identifier hs-type">Grin.Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Tutorial.Chapter01.Exercise02.html#Value"><span class="hs-identifier hs-type">Value</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Definitional"><span class="hs-identifier hs-type">Definitional</span></a><span> </span><a href="#local-6989586621679276741"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Value"><span class="hs-identifier hs-type">Value</span></a><span>
</span><a name="line-332"></a><a name="external"><a href="Tutorial.Chapter01.Exercise02.html#external"><span class="hs-identifier">external</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-333"></a><span>  </span><span class="hs-comment">-- Exercise: Use the MonadReader to retrieve the Context and lookup</span><span>
</span><a name="line-334"></a><span>  </span><span class="hs-comment">-- the function and apply the parameters to it</span><span>
</span><a name="line-335"></a><span>  </span><span class="hs-identifier hs-var">undefined</span><span>
</span><a name="line-336"></a><span>
</span><a name="line-337"></a><span class="hs-identifier">funCall</span><span>
</span><a name="line-338"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#DC"><span class="hs-identifier hs-type">DC</span></a><span> </span><a href="#local-6989586621679276740"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-339"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="Grin.Exp.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Definitional"><span class="hs-identifier hs-type">Definitional</span></a><span> </span><a href="#local-6989586621679276740"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Value"><span class="hs-identifier hs-type">Value</span></a><span class="hs-special">)</span><span>
</span><a name="line-340"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Grin.Value.html#Name"><span class="hs-identifier hs-type">Grin.Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Tutorial.Chapter01.Exercise02.html#Value"><span class="hs-identifier hs-type">Value</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Definitional"><span class="hs-identifier hs-type">Definitional</span></a><span> </span><a href="#local-6989586621679276740"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Value"><span class="hs-identifier hs-type">Value</span></a><span>
</span><a name="line-341"></a><a name="funCall"><a href="Tutorial.Chapter01.Exercise02.html#funCall"><span class="hs-identifier">funCall</span></a></a><span> </span><a name="local-6989586621679276832"><a href="#local-6989586621679276832"><span class="hs-identifier">ev</span></a></a><span> </span><a name="local-6989586621679276833"><a href="#local-6989586621679276833"><span class="hs-identifier">funName</span></a></a><span> </span><a name="local-6989586621679276834"><a href="#local-6989586621679276834"><span class="hs-identifier">values</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-342"></a><span>  </span><span class="hs-comment">-- Exercise:</span><span>
</span><a name="line-343"></a><span>  </span><span class="hs-comment">-- Lookup the function by the given name</span><span>
</span><a name="line-344"></a><span>  </span><span class="hs-comment">-- Retrieve its (Def params body)</span><span>
</span><a name="line-345"></a><span>  </span><span class="hs-comment">-- Create an empty env and bind the function parameters to the given values</span><span>
</span><a name="line-346"></a><span>  </span><span class="hs-comment">-- Run the eval function on the created new local env and body</span><span>
</span><a name="line-347"></a><span>  </span><span class="hs-identifier hs-var">undefined</span><span>
</span><a name="line-348"></a><span>
</span><a name="line-349"></a><span class="hs-identifier">evalCase</span><span>
</span><a name="line-350"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#DC"><span class="hs-identifier hs-type">DC</span></a><span> </span><a href="#local-6989586621679276739"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-351"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="Grin.Exp.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Definitional"><span class="hs-identifier hs-type">Definitional</span></a><span> </span><a href="#local-6989586621679276739"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Value"><span class="hs-identifier hs-type">Value</span></a><span class="hs-special">)</span><span>
</span><a name="line-352"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Value"><span class="hs-identifier hs-type">Value</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Grin.Exp.html#Alt"><span class="hs-identifier hs-type">Alt</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Definitional"><span class="hs-identifier hs-type">Definitional</span></a><span> </span><a href="#local-6989586621679276739"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Value"><span class="hs-identifier hs-type">Value</span></a><span>
</span><a name="line-353"></a><a name="evalCase"><a href="Tutorial.Chapter01.Exercise02.html#evalCase"><span class="hs-identifier">evalCase</span></a></a><span> </span><a name="local-6989586621679276835"><a href="#local-6989586621679276835"><span class="hs-identifier">ev</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-354"></a><span>  </span><span class="hs-comment">-- Exercise:</span><span>
</span><a name="line-355"></a><span>  </span><span class="hs-comment">-- Find the first Alt that matches the given value.</span><span>
</span><a name="line-356"></a><span>  </span><span class="hs-comment">-- If the Alt has a Node pattern, the Val must be a Node</span><span>
</span><a name="line-357"></a><span>  </span><span class="hs-comment">-- In that case bind the values to the names defined in the Alt pattern</span><span>
</span><a name="line-358"></a><span>  </span><span class="hs-comment">-- create a new local environment and evaluate the body of the alt in it.</span><span>
</span><a name="line-359"></a><span>  </span><span class="hs-identifier hs-var">undefined</span><span>
</span><a name="line-360"></a><span>
</span><a name="line-361"></a><span class="hs-comment">-- | Creates a location for a given name. This is particular for the GRIN store structure,</span><span>
</span><a name="line-362"></a><span class="hs-comment">-- where the Store operation must be part of a Bind, thus there will be always a name to</span><span>
</span><a name="line-363"></a><span class="hs-comment">-- bind to, which should hold the address of the created location.</span><span>
</span><a name="line-364"></a><span class="hs-comment">--</span><span>
</span><a name="line-365"></a><span class="hs-comment">-- In this Definitional interpreter for every Store operation that the interpreter evaluates</span><span>
</span><a name="line-366"></a><span class="hs-comment">-- it must creates a new location.</span><span>
</span><a name="line-367"></a><span class="hs-identifier">allocStore</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#DC"><span class="hs-identifier hs-type">DC</span></a><span> </span><a href="#local-6989586621679276738"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Grin.Value.html#Name"><span class="hs-identifier hs-type">Grin.Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Definitional"><span class="hs-identifier hs-type">Definitional</span></a><span> </span><a href="#local-6989586621679276738"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Value"><span class="hs-identifier hs-type">Value</span></a><span>
</span><a name="line-368"></a><a name="allocStore"><a href="Tutorial.Chapter01.Exercise02.html#allocStore"><span class="hs-identifier">allocStore</span></a></a><span> </span><a name="local-6989586621679276836"><a href="#local-6989586621679276836"><span class="hs-identifier">_name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-369"></a><span>  </span><a name="local-6989586621679276837"><a href="#local-6989586621679276837"><span class="hs-identifier">addr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#alloc"><span class="hs-identifier hs-var">alloc</span></a><span>
</span><a name="line-370"></a><span>  </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Prim"><span class="hs-identifier hs-var">Prim</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#SLoc"><span class="hs-identifier hs-var">SLoc</span></a><span> </span><a href="#local-6989586621679276837"><span class="hs-identifier hs-var">addr</span></a><span>
</span><a name="line-371"></a><span>
</span><a name="line-372"></a><span class="hs-comment">-- | Loads the content from the store addressed by the given value</span><span>
</span><a name="line-373"></a><span class="hs-identifier">fetchStore</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#DC"><span class="hs-identifier hs-type">DC</span></a><span> </span><a href="#local-6989586621679276737"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Value"><span class="hs-identifier hs-type">Value</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Definitional"><span class="hs-identifier hs-type">Definitional</span></a><span> </span><a href="#local-6989586621679276737"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Value"><span class="hs-identifier hs-type">Value</span></a><span>
</span><a name="line-374"></a><a name="fetchStore"><a href="Tutorial.Chapter01.Exercise02.html#fetchStore"><span class="hs-identifier">fetchStore</span></a></a><span> </span><a name="local-6989586621679276838"><a href="#local-6989586621679276838"><span class="hs-identifier">addr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-375"></a><span>  </span><a name="local-6989586621679276839"><a href="#local-6989586621679276839"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">get</span><span>
</span><a name="line-376"></a><span>  </span><a name="local-6989586621679276840"><a href="#local-6989586621679276840"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">undefined</span><span> </span><a href="#local-6989586621679276838"><span class="hs-identifier hs-var">addr</span></a><span>
</span><a name="line-377"></a><span>  </span><a href="Tutorial.Chapter01.Exercise02.html#heapVal2val"><span class="hs-identifier hs-var">heapVal2val</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Grin.Interpreter.Store.html#lookup"><span class="hs-identifier hs-var">Store.lookup</span></a><span> </span><a href="#local-6989586621679276840"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679276839"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-378"></a><span>
</span><a name="line-379"></a><span class="hs-comment">-- | Extends the store with the given value.</span><span>
</span><a name="line-380"></a><span class="hs-identifier">extStore</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#DC"><span class="hs-identifier hs-type">DC</span></a><span> </span><a href="#local-6989586621679276736"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Value"><span class="hs-identifier hs-type">Value</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Value"><span class="hs-identifier hs-type">Value</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Definitional"><span class="hs-identifier hs-type">Definitional</span></a><span> </span><a href="#local-6989586621679276736"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-381"></a><a name="extStore"><a href="Tutorial.Chapter01.Exercise02.html#extStore"><span class="hs-identifier">extStore</span></a></a><span> </span><a name="local-6989586621679276841"><a href="#local-6989586621679276841"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621679276842"><a href="#local-6989586621679276842"><span class="hs-identifier">val</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-382"></a><span>  </span><a name="local-6989586621679276843"><a href="#local-6989586621679276843"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">undefined</span><span> </span><a href="#local-6989586621679276841"><span class="hs-identifier hs-var">addr</span></a><span>
</span><a name="line-383"></a><span>  </span><a name="local-6989586621679276844"><a href="#local-6989586621679276844"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#val2heapVal"><span class="hs-identifier hs-var">val2heapVal</span></a><span> </span><a href="#local-6989586621679276842"><span class="hs-identifier hs-var">val</span></a><span>
</span><a name="line-384"></a><span>  </span><span class="hs-identifier hs-var">modify</span><span> </span><span class="hs-special">(</span><a href="Grin.Interpreter.Store.html#insert"><span class="hs-identifier hs-var">Store.insert</span></a><span> </span><a href="#local-6989586621679276843"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679276844"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-385"></a><span>
</span><a name="line-386"></a><span class="hs-comment">-- * The externals that the interpreter can understand</span><span>
</span><a name="line-387"></a><span>
</span><a name="line-388"></a><span class="hs-identifier">knownExternals</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Map.Map</span><span> </span><a href="Grin.Value.html#Name"><span class="hs-identifier hs-type">Grin.Name</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Tutorial.Chapter01.Exercise02.html#Value"><span class="hs-identifier hs-type">Value</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Value"><span class="hs-identifier hs-type">Value</span></a><span class="hs-special">)</span><span>
</span><a name="line-389"></a><a name="knownExternals"><a href="Tutorial.Chapter01.Exercise02.html#knownExternals"><span class="hs-identifier">knownExternals</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map.fromList</span><span>
</span><a name="line-390"></a><span>  </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;prim_int_eq&quot;</span><span class="hs-special">,</span><span>  </span><span class="hs-glyph">\</span><span class="hs-special">[</span><a href="Tutorial.Chapter01.Exercise02.html#Prim"><span class="hs-identifier hs-var">Prim</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#SInt64"><span class="hs-identifier hs-var">SInt64</span></a><span> </span><a name="local-6989586621679276845"><a href="#local-6989586621679276845"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Prim"><span class="hs-identifier hs-var">Prim</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#SInt64"><span class="hs-identifier hs-var">SInt64</span></a><span> </span><a name="local-6989586621679276846"><a href="#local-6989586621679276846"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Prim"><span class="hs-identifier hs-var">Prim</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#SBool"><span class="hs-identifier hs-var">SBool</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679276845"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679276846"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-391"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;prim_int_gt&quot;</span><span class="hs-special">,</span><span>  </span><span class="hs-glyph">\</span><span class="hs-special">[</span><a href="Tutorial.Chapter01.Exercise02.html#Prim"><span class="hs-identifier hs-var">Prim</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#SInt64"><span class="hs-identifier hs-var">SInt64</span></a><span> </span><a name="local-6989586621679276847"><a href="#local-6989586621679276847"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Prim"><span class="hs-identifier hs-var">Prim</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#SInt64"><span class="hs-identifier hs-var">SInt64</span></a><span> </span><a name="local-6989586621679276848"><a href="#local-6989586621679276848"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Prim"><span class="hs-identifier hs-var">Prim</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#SBool"><span class="hs-identifier hs-var">SBool</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679276847"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-6989586621679276848"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-392"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;prim_int_add&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">[</span><a href="Tutorial.Chapter01.Exercise02.html#Prim"><span class="hs-identifier hs-var">Prim</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#SInt64"><span class="hs-identifier hs-var">SInt64</span></a><span> </span><a name="local-6989586621679276849"><a href="#local-6989586621679276849"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Prim"><span class="hs-identifier hs-var">Prim</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#SInt64"><span class="hs-identifier hs-var">SInt64</span></a><span> </span><a name="local-6989586621679276850"><a href="#local-6989586621679276850"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Prim"><span class="hs-identifier hs-var">Prim</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#SInt64"><span class="hs-identifier hs-var">SInt64</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679276849"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679276850"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-393"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;prim_int_sub&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">[</span><a href="Tutorial.Chapter01.Exercise02.html#Prim"><span class="hs-identifier hs-var">Prim</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#SInt64"><span class="hs-identifier hs-var">SInt64</span></a><span> </span><a name="local-6989586621679276851"><a href="#local-6989586621679276851"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Prim"><span class="hs-identifier hs-var">Prim</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#SInt64"><span class="hs-identifier hs-var">SInt64</span></a><span> </span><a name="local-6989586621679276852"><a href="#local-6989586621679276852"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Prim"><span class="hs-identifier hs-var">Prim</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#SInt64"><span class="hs-identifier hs-var">SInt64</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679276851"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621679276852"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-394"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;prim_int_mul&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">[</span><a href="Tutorial.Chapter01.Exercise02.html#Prim"><span class="hs-identifier hs-var">Prim</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#SInt64"><span class="hs-identifier hs-var">SInt64</span></a><span> </span><a name="local-6989586621679276853"><a href="#local-6989586621679276853"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Prim"><span class="hs-identifier hs-var">Prim</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#SInt64"><span class="hs-identifier hs-var">SInt64</span></a><span> </span><a name="local-6989586621679276854"><a href="#local-6989586621679276854"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Prim"><span class="hs-identifier hs-var">Prim</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#SInt64"><span class="hs-identifier hs-var">SInt64</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679276853"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-6989586621679276854"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-395"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;prim_int_print&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#Prim"><span class="hs-identifier hs-var">Prim</span></a><span> </span><span class="hs-special">(</span><a href="Tutorial.Chapter01.Exercise02.html#SInt64"><span class="hs-identifier hs-var">SInt64</span></a><span> </span><a name="local-6989586621679276855"><a href="#local-6989586621679276855"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Tutorial.Chapter01.Exercise02.html#Unit"><span class="hs-identifier hs-var">Unit</span></a><span> </span><span class="hs-operator hs-var">&lt;$</span><span> </span><span class="hs-identifier hs-var">print</span><span> </span><a href="#local-6989586621679276855"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-396"></a><span>  </span><span class="hs-special">]</span><span>
</span><a name="line-397"></a></pre></body></html>